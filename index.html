<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barber Note v3 FINAL</title>
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root{
--primary:#2563eb;
--bg:#f1f5f9;
--card:#ffffff;
--text:#0f172a;
--border:#e2e8f0;
}
body{margin:0;font-family:'Kanit',sans-serif;background:var(--bg);color:var(--text)}
.page{display:none;padding:16px;max-width:520px;margin:auto}
.page.active{display:block}
.card{background:var(--card);border:1px solid var(--border);border-radius:16px;padding:14px;margin-bottom:12px}
input,select,button{width:100%;padding:12px;border-radius:12px;border:1px solid var(--border);font-size:16px}
button{background:var(--primary);color:#fff;font-weight:600;border:none}
.nav{position:fixed;bottom:0;left:0;right:0;height:64px;display:flex;background:#fff;border-top:1px solid var(--border)}
.nav div{flex:1;text-align:center;font-size:12px;padding-top:6px}
.nav .active{color:var(--primary);font-weight:700}
.row{display:flex;gap:8px}
.row>div{flex:1}
.small{font-size:13px;color:#64748b}
.big{font-size:28px;font-weight:800}
.center{text-align:center}
</style>
</head>
<body>

<!-- PAGE 1 RECORD -->
<div id="p1" class="page active">
<div class="row" style="justify-content:flex-end;align-items:center">
<div id="shopName" style="font-size:18px;font-weight:800">BARBER SHOP</div>
<button style="width:auto;background:none;color:#334155" onclick="openSetting()">⚙️</button>
</div>

<div id="setting" style="display:none">
<div class="card">
<div class="small">ชื่อร้าน / สาขา</div>
<input id="s_shop">
<div class="row">
<div>
<div class="small">คอมมิชชั่น %</div>
<input type="number" id="s_per">
</div>
<div>
<div class="small">รายได้ประกัน</div>
<input type="number" id="s_gua">
</div>
</div>
<div class="small">ธีม</div>
<select id="s_theme">
<option value="blue">ธีมฟ้า</option>
<option value="green">ธีมเขียว</option>
<option value="dark">ธีมเข้ม</option>
</select>
<div class="small">พื้นหลัง</div>
<select id="s_bg">
<option value="f1f5f9">เทาอ่อน</option>
<option value="fefce8">เหลืองพาสเทล</option>
<option value="fdf2f8">ชมพูพาสเทล</option>
<option value="ecfeff">ฟ้าพาสเทล</option>
<option value="f0fdf4">เขียวพาสเทล</option>
<option value="faf5ff">ม่วงพาสเทล</option>
<option value="ffffff">ขาว</option>
</select>
<button onclick="saveSetting()">บันทึกการตั้งค่า</button>
</div>
</div>

<div class="card">
<div class="small">วันที่</div>
<input type="date" id="recDate">
<div class="row">
<div><input type="time" id="start" value="09:00"></div>
<div><input type="time" id="end" value="09:30"></div>
</div>
</div>

<div id="services"></div>
<button onclick="addService()">+ เพิ่มบริการ</button>

<div class="card">
<div class="small">การชำระเงิน</div>
<div class="row">
<button onclick="pay='เงินสด'">เงินสด</button>
<button onclick="pay='โอนเงิน'">โอนเงิน</button>
</div>
</div>

<button onclick="saveRecord()">บันทึกข้อมูล</button>
</div>

<!-- PAGE 2 REPORT -->
<div id="p2" class="page">
<div class="center">
<div id="rShop" style="font-size:20px;font-weight:800"></div>
<div id="rDate" style="font-size:18px;font-weight:700"></div>
</div>

<div class="row">
<div class="card">
<div class="small">ยอดเงินรวม</div>
<div class="big" id="sumTotal">0</div>
<div>ลูกค้า <span id="sumCust">0</span> คน</div>
<div class="small" id="extraCount"></div>
</div>
<div class="card">
<div>ยอดโอน <b id="sumTrans">0</b></div>
<div>รายได้ช่าง <b id="sumBarber">0</b></div>
<div>รายได้ร้าน <b id="sumShop">0</b></div>
</div>
</div>

<div id="clearStatus" class="card center"></div>
<div id="listToday"></div>

<button onclick="clearToday()" style="background:#dc2626">ลบข้อมูลวันนี้</button>
<button onclick="go(3)">ดูย้อนหลัง</button>
</div>

<!-- PAGE 3 HISTORY -->
<div id="p3" class="page">
<div class="card">
<input type="date" id="hisDate" onchange="renderHistory()">
</div>
<div id="history"></div>
</div>

<div class="nav">
<div class="active" onclick="go(1)">บันทึก</div>
<div onclick="go(2)">รายงาน</div>
<div onclick="go(3)">ย้อนหลัง</div>
</div>

<script>
const SERVICE=["ตัดผม","โกนหนวด","กันหน้า","แก้ผม","โกนผม","สระผม","ย้อมผม","ดัดผม","อื่นๆ"];
const STYLE=["รองทรง","สกินเฟด","แฟชั่น","นักเรียน","ตำรวจ / ทหาร","ทรงอเมริกัน","เปิดข้าง","วินเทจ","อื่นๆ"];

let db=JSON.parse(localStorage.getItem("bn_db")||"[]");
let cfg=JSON.parse(localStorage.getItem("bn_cfg")||'{"shop":"BARBER SHOP","per":50,"gua":0}');
let pay="เงินสด";

function go(n){
document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
document.querySelectorAll('.nav div').forEach(nv=>nv.classList.remove('active'));
document.getElementById('p'+n).classList.add('active');
document.querySelectorAll('.nav div')[n-1].classList.add('active');
if(n===2)renderReport();
if(n===3)renderHistory();
}

function addService(){
let d=document.createElement('div');
d.className="card";
d.innerHTML=`
<select class="svc">${SERVICE.map(s=>`<option>${s}</option>`).join("")}</select>
<select class="sty">${STYLE.map(s=>`<option>${s}</option>`).join("")}</select>
<input type="number" class="price" value="100">`;
services.appendChild(d);
}

function saveRecord(){
let items=[...document.querySelectorAll('.price')].map((p,i)=>({
svc:document.querySelectorAll('.svc')[i].value,
sty:document.querySelectorAll('.sty')[i].value,
price:+p.value
}));
let total=items.reduce((s,i)=>s+i.price,0);
db.push({date:recDate.value,pay,items,total});
localStorage.setItem("bn_db",JSON.stringify(db));
services.innerHTML="";addService();go(2);
}

function renderReport(){
let d=recDate.value;
let rec=db.filter(r=>r.date===d);
let total=rec.reduce((s,r)=>s+r.total,0);
let trans=rec.filter(r=>r.pay==="โอนเงิน").reduce((s,r)=>s+r.total,0);
let barber=rec.length===0?cfg.gua:Math.max(total*cfg.per/100,cfg.gua);
let shop=total-barber;
rShop.innerText=cfg.shop;
rDate.innerText=new Date(d).toLocaleDateString('th-TH',{dateStyle:'long'});
sumTotal.innerText=total;
sumCust.innerText=rec.length;
sumTrans.innerText=trans;
sumBarber.innerText=barber;
sumShop.innerText=shop;
let diff=trans-barber;
clearStatus.innerText=diff===0?"ยอดพอดีไม่ต้องคืน":diff>0?`ช่างคืนร้าน ${diff}`:`ร้านคืนช่าง ${-diff}`;
listToday.innerHTML=rec.map(r=>`<div class="card">${r.items.map(i=>i.svc).join(",")} = ${r.total}</div>`).join("");
}

function clearToday(){
db=db.filter(r=>r.date!==recDate.value);
localStorage.setItem("bn_db",JSON.stringify(db));
renderReport();
}

function renderHistory(){
let d=hisDate.value;
let m=d.slice(0,7);
let rec=db.filter(r=>r.date.startsWith(m));
history.innerHTML=`<div class="card">ลูกค้าทั้งหมด ${rec.length} คน</div>`;
}

function openSetting(){
setting.style.display=setting.style.display==="none"?"block":"none";
s_shop.value=cfg.shop;s_per.value=cfg.per;s_gua.value=cfg.gua;
}
function saveSetting(){
cfg={shop:s_shop.value,per:+s_per.value,gua:+s_gua.value};
localStorage.setItem("bn_cfg",JSON.stringify(cfg));
shopName.innerText=cfg.shop;rShop.innerText=cfg.shop;
openSetting();
}

recDate.value=new Date().toISOString().split("T")[0];
hisDate.value=recDate.value;
shopName.innerText=cfg.shop;
addService();
</script>
</body>
</html>
