<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barber Note Pro</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1a2a40; --accent: #c5a059; --bg: #f0f2f5; --card: #ffffff; --text: #1a2a40; --sub: #666; }
        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { background-color: var(--bg); color: var(--text); margin: 0; padding-top: 10px; padding-bottom: 100px; }
        .container { padding: 15px; max-width: 500px; margin: auto; }
        
        /* การสลับหน้า */
        .page { display: none; transition: 0.3s; }
        .page.active { display: block; }
        
        /* การ์ดและอินพุต */
        .card { background: var(--card); border-radius: 15px; padding: 15px; margin-bottom: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .label-small { display: block; font-size: 0.85rem; color: var(--sub); margin-bottom: 5px; font-weight: 600; }
        .input-group { background: #f8f9fa; border: 1px solid #e0e0e0; border-radius: 10px; padding: 12px; margin-bottom: 12px; }
        .input-group select, .input-group input { width: 100%; border: none; background: transparent; font-size: 1.15rem; outline: none; color: var(--text); font-weight: 500; }
        
        /* ยอดรวม */
        .total-display { background: var(--primary); color: white; padding: 25px; border-radius: 20px; text-align: center; margin: 15px 0; border: 2px solid var(--accent); }
        .total-display span { color: var(--accent); font-size: 2.5rem; font-weight: bold; }
        
        /* ปุ่มบันทึก/จ่ายเงิน */
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .btn-pay { background: white; border: 2px solid #ddd; border-radius: 12px; padding: 18px; text-align: center; font-weight: 600; cursor: pointer; }
        .btn-pay.active { background: var(--primary); color: white; border-color: var(--primary); }
        .btn-save { width: 100%; background: var(--accent); color: white; border: none; padding: 22px; border-radius: 18px; font-size: 1.3rem; font-weight: bold; cursor: pointer; box-shadow: 0 4px 12px rgba(197, 160, 89, 0.3); }

        /* ส่วนรายงาน */
        .date-filter { background: var(--primary); color: white; border-radius: 15px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; }
        .date-filter input { background: white; border: none; padding: 8px; border-radius: 8px; font-family: 'Kanit'; }
        
        .report-summary { background: #1c1c1e; color: white; border-radius: 25px; padding: 20px; margin-bottom: 15px; }
        .count-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; margin: 15px 0; }
        .count-box { background: rgba(255,255,255,0.08); padding: 12px; border-radius: 15px; text-align: center; border: 1px solid rgba(197, 160, 89, 0.2); }
        .count-box span { font-size: 0.75rem; opacity: 0.6; display: block; }
        .count-box b { color: var(--accent); font-size: 1.2rem; }

        /* เมนูท้าย */
        .bottom-nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; border-top: 1px solid #eee; height: 85px; z-index: 1000; }
        .nav-btn { text-align: center; color: #999; font-size: 0.85rem; flex: 1; cursor: pointer; }
        .nav-btn.active { color: var(--primary); font-weight: bold; }
        .nav-btn i { font-size: 1.6rem; display: block; margin-bottom: 5px; }
        
        /* รายการประวัติ */
        .history-item { background: white; border-radius: 15px; padding: 18px; margin-bottom: 10px; border-left: 6px solid var(--accent); display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div class="container">
        <div id="page-record" class="page active">
            <div class="card">
                <span class="label-small">เลือกบริการ</span>
                <div class="input-group">
                    <select id="svc-main" onchange="updatePrice()">
                        <option value="ตัดผม">ตัดผม</option>
                        <option value="โกนหนวด">โกนหนวด</option>
                        <option value="กันหน้า">กันหน้า</option>
                        <option value="แก้ผม">แก้ผม</option>
                        <option value="สระผม">สระผม</option>
                        <option value="ย้อมผม">ย้อมผม</option>
                        <option value="ดัดผม">ดัดผม</option>
                        <option value="ยืดผม">ยืดผม</option>
                        <option value="อื่นๆ">อื่นๆ</option>
                    </select>
                </div>
                <span class="label-small">ทรงผม</span>
                <div class="input-group">
                    <select id="style-main">
                        <option value="รองทรง">รองทรง</option>
                        <option value="แฟชั่น / ทูบล็อค">แฟชั่น / ทูบล็อค</option>
                        <option value="สกินเฟด">สกินเฟด</option>
                        <option value="นักเรียน">นักเรียน</option>
                        <option value="ตำรวจ / ทหาร">ตำรวจ / ทหาร</option>
                        <option value="ทรงอเมริกัน">ทรงอเมริกัน</option>
                        <option value="เปิดข้าง / วินเทจ">เปิดข้าง / วินเทจ</option>
                        <option value="-">ไม่ระบุทรง</option>
                    </select>
                </div>
                <span class="label-small">ราคา (บาท)</span>
                <div class="input-group">
                    <input type="number" id="amt-main" value="150" oninput="syncTotal()">
                </div>
            </div>
            <div class="total-display">ยอดต้องรับเงิน ฿<span id="total-text">150</span></div>
            <div class="pay-grid">
                <div id="p-cash" class="btn-pay active" onclick="setPay('เงินสด')">เงินสด</div>
                <div id="p-tran" class="btn-pay" onclick="setPay('เงินโอน')">เงินโอน</div>
            </div>
            <button class="btn-save" onclick="saveData()">บันทึกรายการ</button>
        </div>

        <div id="page-report" class="page">
            <div class="date-filter">
                <span><i class="fas fa-search"></i> ดูประวัติวันที่:</span>
                <input type="date" id="report-date-input" onchange="renderReport()">
            </div>
            
            <div class="report-summary">
                <div style="text-align:center; padding-bottom:15px; border-bottom:1px solid rgba(255,255,255,0.1); margin-bottom:15px;">
                    <b style="font-size:2.8rem; color:var(--accent);" id="rep-total">฿0</b>
                </div>
                <div class="count-grid">
                    <div class="count-box"><span>โกนหนวด</span><b id="count-shave">0</b></div>
                    <div class="count-box"><span>สระผม</span><b id="count-wash">0</b></div>
                    <div class="count-box"><span>ย้อมผม</span><b id="count-dye">0</b></div>
                </div>
                <div style="text-align:center; opacity:0.8; font-size: 0.9rem;">
                    ลูกค้าวันที่เลือก: <b id="rep-count" style="color:var(--accent)">0</b> คน
                </div>
            </div>
            
            <div id="history-list">
                </div>
        </div>
    </div>

    <nav class="bottom-nav">
        <div class="nav-btn active" id="nav-record" onclick="goPage('record')">
            <i class="fas fa-edit"></i>จดงาน
        </div>
        <div class="nav-btn" id="nav-report" onclick="goPage('report')">
            <i class="fas fa-history"></i>รายงานย้อนหลัง
        </div>
    </nav>

    <script>
        let payType = 'เงินสด';
        let db = JSON.parse(localStorage.getItem('barber_vfinal_db') || '[]');

        // เมื่อเปิดแอปมาครั้งแรก
        window.onload = () => {
            let today = new Date().toISOString().split('T')[0];
            document.getElementById('report-date-input').value = today;
            renderReport(); // เตรียมหน้ารายงานไว้ก่อน
        };

        function goPage(p) {
            // ซ่อนทุกหน้าก่อน
            document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
            // เอาสีปุ่มออก
            document.querySelectorAll('.nav-btn').forEach(x => x.classList.remove('active'));
            
            // เปิดหน้าและเปลี่ยนสีปุ่มที่เลือก
            document.getElementById('page-'+p).classList.add('active');
            document.getElementById('nav-'+p).classList.add('active');
            
            if(p === 'report') {
                renderReport(); // สั่งให้คำนวณและวาดหน้ารายงานทันที
            }
        }

        function updatePrice() {
            const svc = document.getElementById('svc-main').value;
            let p = 150;
            if(svc === 'โกนหนวด') p = 60;
            if(svc === 'กันหน้า') p = 40;
            if(svc === 'แก้ผม') p = 50;
            if(svc === 'สระผม') p = 40;
            if(svc === 'ย้อมผม') p = 200;
            if(svc === 'ดัดผม' || svc === 'ยืดผม') p = 500;
            if(svc === 'อื่นๆ') p = 0;
            document.getElementById('amt-main').value = p;
            syncTotal();
        }

        function syncTotal() {
            let val = document.getElementById('amt-main').value || 0;
            document.getElementById('total-text').innerText = parseInt(val).toLocaleString();
        }

        function setPay(t) {
            payType = t;
            document.getElementById('p-cash').classList.toggle('active', t === 'เงินสด');
            document.getElementById('p-tran').classList.toggle('active', t === 'เงินโอน');
        }

        function saveData() {
            let total = parseInt(document.getElementById('amt-main').value) || 0;
            let record = {
                date: new Date().toISOString().split('T')[0],
                svc: document.getElementById('svc-main').value,
                style: document.getElementById('style-main').value,
                amt: total,
                pay: payType,
                time: new Date().toLocaleTimeString('th-TH', {hour: '2-digit', minute:'2-digit'})
            };
            db.push(record);
            localStorage.setItem('barber_vfinal_db', JSON.stringify(db));
            alert('บันทึกสำเร็จ!');
            location.reload(); // รีเฟรชเพื่อให้ข้อมูลอัปเดต
        }

        function renderReport() {
            let selectedDate = document.getElementById('report-date-input').value;
            let data = db.filter(x => x.date === selectedDate);
            
            // คำนวณยอด
            let sum = data.reduce((s, x) => s + x.amt, 0);
            document.getElementById('rep-total').innerText = "฿" + sum.toLocaleString();
            document.getElementById('rep-count').innerText = data.length;
            
            // นับจำนวน
            document.getElementById('count-shave').innerText = data.filter(x => x.svc === 'โกนหนวด').length;
            document.getElementById('count-wash').innerText = data.filter(x => x.svc === 'สระผม').length;
            document.getElementById('count-dye').innerText = data.filter(x => x.svc === 'ย้อมผม').length;

            // วาดรายการประวัติ
            let historyHTML = '';
            if(data.length === 0) {
                historyHTML = '<div style="text-align:center; color:#999; margin-top:20px;">ไม่มีข้อมูลของวันที่เลือก</div>';
            } else {
                data.reverse().forEach(x => {
                    historyHTML += `
                        <div class="history-item">
                            <div>
                                <b style="font-size:1.1rem">${x.svc}</b><br>
                                <small style="color:var(--sub)">${x.style !== '-' ? x.style : ''} | ${x.pay} (${x.time} น.)</small>
                            </div>
                            <div style="font-weight:bold; font-size:1.2rem; color:var(--primary);">฿${x.amt}</div>
                        </div>
                    `;
                });
            }
            document.getElementById('history-list').innerHTML = historyHTML;
        }
    </script>
</body>
</html>
