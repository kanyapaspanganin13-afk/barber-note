<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-title" content="Barber Note">
<link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
<title>Barber Note v2.1</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

<style>
/* ================== THEME ================== */
:root{
  --primary:#2b459a;
  --bg:#f8fafc;
  --card:#ffffff;
  --text:#334155;
  --sub:#94a3b8;
  --border:#e2e8f0;
}
.theme-blue{--primary:#2b459a}
.theme-dark{
  --primary:#111827;
  --bg:#020617;
  --card:#020617;
  --text:#f8fafc;
  --border:#1e293b;
}
.theme-green{--primary:#166534}

.bg-white{--bg:#ffffff}
.bg-blue{--bg:#f0f9ff}
.bg-green{--bg:#f0fdf4}
.bg-yellow{--bg:#fefce8}
.bg-pink{--bg:#fdf2f8}
.bg-purple{--bg:#faf5ff}
.bg-gray{--bg:#f8fafc}

/* ================== BASE ================== */
*{box-sizing:border-box;font-family:'Kanit',sans-serif}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  padding-bottom:80px;
}
.page{display:none;padding:15px;max-width:500px;margin:auto}
.page.active{display:block}
.header{
  background:var(--card);
  border-bottom:1px solid var(--border);
  padding:14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
}
.header .shop{font-weight:600;color:var(--primary)}
.card{
  background:var(--card);
  border:1px solid var(--border);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}
.label{font-size:12px;color:var(--sub);margin-bottom:6px}
input,select{
  width:100%;
  padding:12px;
  border-radius:10px;
  border:1px solid var(--border);
}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.btn{
  width:100%;
  background:var(--primary);
  color:#fff;
  border:none;
  padding:16px;
  border-radius:14px;
  font-size:16px;
  font-weight:600;
}
.svc-row{
  display:grid;
  grid-template-columns:1fr 1fr 70px 30px;
  gap:6px;
  margin-bottom:8px;
}
.nav{
  position:fixed;
  bottom:0;
  width:100%;
  height:70px;
  display:flex;
  background:var(--card);
  border-top:1px solid var(--border);
}
.nav div{
  flex:1;
  text-align:center;
  padding-top:10px;
  font-size:12px;
  color:var(--sub);
}
.nav .active{color:var(--primary);font-weight:600}
.stat{
  text-align:center;
  background:var(--primary);
  color:#fff;
  border-radius:14px;
  padding:14px;
}
.hist{
  border:1px solid var(--border);
  border-radius:12px;
  padding:10px;
  margin-bottom:8px;
}
</style>
</head>

<body>

<!-- ================== PAGE : RECORD ================== -->
<div id="rec" class="page active">
  <div class="header">
    <div class="shop" id="shopNameRec"></div>
    <i class="fas fa-cog" onclick="go('set')"></i>
  </div>

  <div class="card">
    <div class="label">วันที่</div>
    <input type="date" id="recDate">
    <div class="grid2" style="margin-top:10px">
      <input type="time" id="start">
      <input type="time" id="end">
    </div>
  </div>

  <div class="card">
    <div class="label">บริการ</div>
    <div id="svcList"></div>
    <small onclick="addRow()" style="color:var(--primary)">+ เพิ่มบริการ</small>
  </div>

  <div class="grid2">
    <button onclick="pay='เงินสด'" class="btn">เงินสด</button>
    <button onclick="pay='โอนเงิน'" class="btn">โอนเงิน</button>
  </div>

  <button class="btn" style="margin-top:10px" onclick="save()">บันทึก</button>
</div>

<!-- ================== PAGE : REPORT ================== -->
<div id="rep" class="page">
  <div class="header"><div class="shop" id="shopNameRep"></div></div>
  <div class="stat">
    <div id="repDate"></div>
    <h2>฿ <span id="sumTotal">0</span></h2>
    <small>ช่าง <span id="barber">0</span> | ร้าน <span id="shop">0</span></small>
  </div>
  <div id="repList"></div>
</div>

<!-- ================== PAGE : HISTORY ================== -->
<div id="his" class="page">
  <div class="header"><div class="shop">ประวัติย้อนหลัง</div></div>
  <input type="date" id="hisDate" onchange="renderHistory()">
  <div id="hisList"></div>
</div>

<!-- ================== PAGE : SETTING ================== -->
<div id="set" class="page">
  <div class="header"><div class="shop">ตั้งค่า</div></div>

  <div class="card">
    <div class="label">ชื่อร้าน</div>
    <input id="shopInput">
  </div>

  <div class="card">
    <div class="label">เปอร์เซ็นต์ช่าง</div>
    <input type="number" id="percent">
    <div class="label">ประกันรายวัน</div>
    <input type="number" id="guarantee">
  </div>

  <div class="card">
    <div class="label">ธีม</div>
    <select id="theme">
      <option value="theme-blue">Classic Blue</option>
      <option value="theme-dark">Dark Barber</option>
      <option value="theme-green">Green Minimal</option>
    </select>

    <div class="label">พื้นหลัง</div>
    <select id="bg">
      <option value="bg-white">ขาว</option>
      <option value="bg-blue">ฟ้า</option>
      <option value="bg-green">เขียว</option>
      <option value="bg-yellow">เหลือง</option>
      <option value="bg-pink">ชมพู</option>
      <option value="bg-purple">ม่วง</option>
      <option value="bg-gray">เทา</option>
    </select>
  </div>

  <button class="btn" onclick="saveCfg()">บันทึกการตั้งค่า</button>
</div>

<!-- ================== NAV ================== -->
<div class="nav">
  <div class="active" onclick="go('rec')">บันทึก</div>
  <div onclick="go('rep')">รายงาน</div>
  <div onclick="go('his')">ย้อนหลัง</div>
  <div onclick="go('set')">ตั้งค่า</div>
</div>

<script>
/* ================== DATA ================== */
const SERVICES=["ตัดผม","โกนหนวด","กันหน้า","สระผม","ย้อมผม","ดัดผม","ยืดผม","แก้ผม","อื่นๆ"];
const STYLES=["รองทรง","สกินเฟด","แฟชั่น","นักเรียน","ทหาร","อเมริกัน","วินเทจ","อื่นๆ"];

let db=JSON.parse(localStorage.getItem("bn_db")||"[]");
let cfg=JSON.parse(localStorage.getItem("bn_cfg")||
'{"shop":"BARBER SHOP","percent":50,"guarantee":300,"theme":"theme-blue","bg":"bg-gray"}');
let pay="เงินสด";

/* ================== INIT ================== */
function init(){
  document.body.className=cfg.theme+" "+cfg.bg;
  shopNameRec.innerText=shopNameRep.innerText=cfg.shop;
  shopInput.value=cfg.shop;
  percent.value=cfg.percent;
  guarantee.value=cfg.guarantee;
  theme.value=cfg.theme;
  bg.value=cfg.bg;
  recDate.value=hisDate.value=new Date().toISOString().split("T")[0];
  addRow();
}
init();

/* ================== FUNCTIONS ================== */
function addRow(){
  let d=document.createElement("div");
  d.className="svc-row";
  d.innerHTML=`
    <select>${SERVICES.map(s=>`<option>${s}</option>`)}</select>
    <select>${STYLES.map(s=>`<option>${s}</option>`)}</select>
    <input type="number" value="150">
    <span onclick="this.parentNode.remove()">✕</span>`;
  svcList.appendChild(d);
}

function save(){
  let total=0,items=[];
  document.querySelectorAll(".svc-row").forEach(r=>{
    let p=parseInt(r.children[2].value)||0;
    total+=p;
    items.push({svc:r.children[0].value,style:r.children[1].value,price:p});
  });
  if(total===0)return alert("กรุณาใส่ราคา");
  db.push({id:Date.now(),date:recDate.value,items,total,pay});
  localStorage.setItem("bn_db",JSON.stringify(db));
  svcList.innerHTML="";
  addRow();
}

function go(p){
  document.querySelectorAll(".page").forEach(x=>x.classList.remove("active"));
  document.getElementById(p).classList.add("active");
  if(p==="rep")renderReport();
  if(p==="his")renderHistory();
}

function renderReport(){
  let d=recDate.value;
  let day=db.filter(x=>x.date===d);
  let sum=day.reduce((s,x)=>s+x.total,0);
  let barber=Math.max(cfg.guarantee,sum*cfg.percent/100);
  sumTotal.innerText=sum;
  barberSpan=barber;
  shop.innerText=sum-barber;
  repDate.innerText=new Date(d).toLocaleDateString("th-TH",{dateStyle:"long"});
  repList.innerHTML=day.map(x=>`
    <div class="hist">${x.items.map(i=>i.svc).join("+")} ฿${x.total}</div>`).join("");
}

function renderHistory(){
  let d=hisDate.value;
  let day=db.filter(x=>x.date===d);
  hisList.innerHTML=day.map(x=>`
    <div class="hist">${x.items.map(i=>i.svc).join("+")} ฿${x.total}</div>`).join("")||"ไม่มีข้อมูล";
}

function saveCfg(){
  cfg={
    shop:shopInput.value,
    percent:+percent.value,
    guarantee:+guarantee.value,
    theme:theme.value,
    bg:bg.value
  };
  localStorage.setItem("bn_cfg",JSON.stringify(cfg));
  location.reload();
}
</script>
</body>
</html>
