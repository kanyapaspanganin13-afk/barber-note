<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1" />
<title>Barber Note</title>

<!-- PWA / App-like -->
<link rel="apple-touch-icon" href="https://upload.wikimedia.org/wikipedia/commons/2/2d/Barber_Pole.svg">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">

<style>
/* ====== ธีมมินิมอลโมเดิร์น ====== */
:root{
  --primary:#222;
  --bg:#f6f7fb;
  --card:#fff;
  --green:#16a34a;
  --red:#dc2626;
  --blue:#2563eb;
  --gray:#6b7280;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI";
  background:var(--bg);
  color:var(--primary);
}

header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  padding:12px 16px;
  font-weight:600;
}

button{
  padding:10px 14px;
  border:none;
  border-radius:10px;
  font-size:16px;
}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin:10px;
}

input,select{
  width:100%;
  padding:12px;
  font-size:16px;
  margin-top:6px;
}

.nav{
  display:flex;
  justify-content:space-around;
  padding:10px;
  background:#fff;
  position:fixed;
  bottom:0;
  width:100%;
}

.hidden{display:none}

.line-btn{
  background:#06c755;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}

.line-btn img{
  width:24px;
  height:24px;
}
</style>
</head>

<body>

<!-- ================= PAGE 1 : RECORD ================= -->
<section id="page-record">
<header>
  <div id="shopName">ร้านตัดผม</div>
  <button onclick="toggleSetting()">⚙️</button>
</header>

<div class="card hidden" id="settingBox">
  <label>ชื่อร้าน / สาขา</label>
  <input id="setShop" />

  <label>เปอร์เซ็นต์รายได้ช่าง (%)</label>
  <input type="number" id="setPercent" />

  <label>รายได้ประกันต่อวัน</label>
  <input type="number" id="setGuarantee" />
</div>

<div class="card">
  <label>วันที่</label>
  <input type="date" id="dateInput">

  <label>เวลาเริ่ม</label>
  <input type="time" id="startTime">

  <label>เวลาสิ้นสุด</label>
  <input type="time" id="endTime">
</div>

<div class="card">
  <label>บริการ</label>
  <select id="service">
    <option>ตัดผม</option><option>โกนหนวด</option><option>กันหน้า</option>
    <option>แก้ผม</option><option>โกนผม</option><option>สระผม</option>
    <option>ย้อมผม</option><option>ดัดผม</option><option>อื่นๆ</option>
  </select>

  <label>ทรงผม</label>
  <select id="style">
    <option>รองทรง</option><option>สกินเฟด</option><option>แฟชั่น</option>
    <option>นักเรียน</option><option>ตำรวจ / ทหาร</option>
    <option>ทรงอเมริกัน</option><option>เปิดข้าง</option>
    <option>วินเทจ</option><option>อื่นๆ</option>
  </select>

  <label>ราคา</label>
  <input type="number" id="price">
</div>

<div class="card">
  <label>การชำระเงิน</label>
  <button id="cashBtn" onclick="setPay('เงินสด')">เงินสด</button>
  <button id="transferBtn" onclick="setPay('โอนเงิน')">โอนเงิน</button>
</div>

<button style="margin:10px;width:calc(100% - 20px)" onclick="saveRecord()">บันทึกข้อมูล</button>
</section>

<!-- ================= PAGE 2 : DAILY REPORT ================= -->
<section id="page-report" class="hidden">
<header style="justify-content:center">
  <div id="reportShop"></div>
</header>

<div class="card" id="reportDate"></div>

<div style="display:flex">
  <div class="card" style="flex:1">
    <div id="totalMoney"></div>
    <div id="totalCustomer"></div>
    <div id="extraService"></div>
  </div>

  <div class="card" style="flex:1">
    <div id="transferTotal"></div>
    <div id="barberIncome"></div>
    <div id="shopIncome"></div>
  </div>
</div>

<div class="card" id="clearStatus"></div>

<div class="card" id="recordList"></div>

<button class="line-btn" onclick="sendLine()">
  <img src="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg">
  ส่งรายงานเข้า LINE
</button>
</section>

<!-- ================= PAGE 3 : HISTORY ================= -->
<section id="page-history" class="hidden">
<div class="card" id="historyBox"></div>
</section>

<div class="nav">
  <button onclick="showPage('record')">บันทึก</button>
  <button onclick="showPage('report')">รายงาน</button>
  <button onclick="showPage('history')">ย้อนหลัง</button>
</div>

<script>
/* ===== CONFIG ===== */
const TEST_MODE = true;
let payType = "เงินสด";

/* ===== STORAGE ===== */
function getData(){return JSON.parse(localStorage.getItem("records")||"[]")}
function setData(d){localStorage.setItem("records",JSON.stringify(d))}

/* ===== PAGE ===== */
function showPage(p){
  document.querySelectorAll("section").forEach(s=>s.classList.add("hidden"));
  document.getElementById("page-"+p).classList.remove("hidden");
  if(p==="report") renderReport();
  if(p==="history") renderHistory();
}

/* ===== SETTING ===== */
function toggleSetting(){
  settingBox.classList.toggle("hidden");
}

/* ===== PAY ===== */
function setPay(t){
  payType=t;
  cashBtn.style.background=t==="เงินสด"?"#ddd":"";
  transferBtn.style.background=t==="โอนเงิน"?"#ddd":"";
}

/* ===== SAVE ===== */
function saveRecord(){
  const rec={
    date:dateInput.value,
    service:service.value,
    style:style.value,
    price:+price.value,
    pay:payType
  };
  const d=getData();
  d.push(rec);
  setData(d);
  alert("บันทึกสำเร็จ");
  price.value="";
}

/* ===== REPORT ===== */
function renderReport(){
  const data=getData();
  const today=data.filter(r=>r.date===dateInput.value);

  let total=0,transfer=0;
  today.forEach(r=>{
    total+=r.price;
    if(r.pay==="โอนเงิน") transfer+=r.price;
  });

  const percent=+setPercent.value||50;
  const guarantee=+setGuarantee.value||0;

  let barber=Math.max(total*percent/100,guarantee);
  let shop=total-barber;

  totalMoney.innerText="ยอดรวม "+total+" บาท";
  totalCustomer.innerText="ลูกค้า "+today.length+" คน";
  transferTotal.innerText="ยอดโอน "+transfer+" บาท";
  barberIncome.innerText="รายได้ช่าง "+barber;
  shopIncome.innerText="รายได้ร้าน "+shop;

  let status="ยอดพอดีไม่ต้องคืน";
  if(barber>total*percent/100) status="ร้านคืนช่าง";
  if(barber<total*percent/100) status="ช่างคืนร้าน";
  clearStatus.innerText=status;

  recordList.innerHTML=today.map(r=>`• ${r.service} ${r.price} (${r.pay})`).join("<br>");
}

/* ===== LINE ===== */
function sendLine(){
  const text=encodeURIComponent(document.getElementById("page-report").innerText);
  window.open("https://line.me/R/msg/text/?"+text);
}

/* ===== HISTORY ===== */
function renderHistory(){
  historyBox.innerText=JSON.stringify(getData(),null,2);
}
</script>

</body>
</html>
