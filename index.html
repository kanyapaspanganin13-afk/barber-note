<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Barber Note">
    <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
    <title>Barber Note Pro V6.4</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">


<style>
:root{
  --primary:#111827;
  --bg:#f5f7fb;
  --card:#ffffff;
  --accent:#16a34a;
  --danger:#dc2626;
  --info:#2563eb;
  --muted:#6b7280;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--primary);
  padding-bottom: 80px; /* กันโดน nav ทับ */
}

header{
  padding:12px 16px;
  background:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #e5e7eb;
}

header h1{
  font-size:18px;
  margin:0;
}

button{
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-size:15px;
  cursor: pointer;
}

.btn-primary{background:#111827;color:#fff;}
.btn-green{background:var(--accent);color:#fff;}
.btn-blue{background:var(--info);color:#fff;}
.btn-red{background:var(--danger);color:#fff;}
.btn-outline{background:#fff;border:1px solid #d1d5db;}

.page{display:none;padding:14px;}
.page.active{display:block;}

.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

label{font-size:13px;color:var(--muted); display: block; margin-bottom: 4px; margin-top: 8px;}
input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px;
  box-sizing: border-box;
}

.big-number{
  font-size:22px;
  font-weight:700;
}

.status-ok{color:#16a34a;}
.status-back{color:#dc2626;}
.status-equal{color:#6b7280;}

.record-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px dashed #e5e7eb;
  padding:10px 0;
  font-size:14px;
}

.footer-nav{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  display:flex;
  border-top:1px solid #e5e7eb;
}
.footer-nav button{
  flex:1;
  border-radius:0;
  padding:16px;
  background:#fff;
  color: var(--muted);
}
.footer-nav button.active {
  color: var(--primary);
  font-weight: bold;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
  z-index: 1000;
}
.modal-content{
  background:#fff;
  width:90%;
  border-radius:16px;
  padding:16px;
}
</style>
</head>

<body>

<header>
  <h1 id="shopName">ร้านตัดผม</h1>
  <button class="btn-outline" onclick="openSetting()">⚙️</button>
</header>

<div class="page active" id="page1">
  <div class="card">
    <label>วันที่</label>
    <input type="date" id="dateInput">

    <div class="grid-2">
      <div>
        <label>เวลาเริ่ม</label>
        <input type="time" id="startTime" value="09:00">
      </div>
      <div>
        <label>เวลาสิ้นสุด</label>
        <input type="time" id="endTime" value="09:30">
      </div>
    </div>
  </div>

  <div class="card">
    <label>บริการ</label>
    <select id="service">
      <option value="ตัดผม">ตัดผม</option>
      <option value="โกนหนวด">โกนหนวด</option>
      <option value="กันหน้า">กันหน้า</option>
      <option value="แก้ผม">แก้ผม</option>
      <option value="โกนผม">โกนผม</option>
      <option value="สระผม">สระผม</option>
      <option value="ย้อมผม">ย้อมผม</option>
      <option value="ดัดผม">ดัดผม</option>
      <option value="อื่นๆ">อื่นๆ</option>
    </select>

    <label>ทรงผม</label>
    <select id="hair">
      <option value="">ไม่ระบุ</option>
      <option value="รองทรง">รองทรง</option>
      <option value="สกินเฟด">สกินเฟด</option>
      <option value="แฟชั่น">แฟชั่น</option>
      <option value="นักเรียน">นักเรียน</option>
      <option value="ตำรวจ / ทหาร">ตำรวจ / ทหาร</option>
      <option value="ทรงอเมริกัน">ทรงอเมริกัน</option>
      <option value="เปิดข้าง">เปิดข้าง</option>
      <option value="วินเทจ">วินเทจ</option>
      <option value="อื่นๆ">อื่นๆ</option>
    </select>

    <label>ราคา</label>
    <input type="number" id="price" placeholder="0">
  </div>

  <div class="card">
    <label>วิธีชำระเงิน</label>
    <div class="grid-2">
      <button id="cashBtn" class="btn-outline" onclick="setPay('เงินสด')">เงินสด</button>
      <button id="transferBtn" class="btn-outline" onclick="setPay('โอนเงิน')">โอนเงิน</button>
    </div>
  </div>

  <button class="btn-primary" style="width:100%" onclick="saveRecord()">บันทึกข้อมูล</button>
</div>

<div class="page" id="page2">
  <div class="card" style="text-align:center">
    <div id="dailyDate" class="big-number"></div>
  </div>

  <div class="grid-2">
    <div class="card">
      <div style="font-size:13px; color:var(--muted)">ยอดรวม</div>
      <div id="sumTotal" class="big-number">0</div>
      <div style="font-size:13px; margin-top:8px;">ลูกค้า <span id="sumCount">0</span> คน</div>
      <div style="font-size:13px;">บริการเพิ่ม <span id="extraCount">0</span></div>
    </div>

    <div class="card">
      <div style="font-size:13px; color:var(--muted)">ยอดโอน</div>
      <div id="sumTransfer" class="big-number">0</div>
      <div style="font-size:13px; margin-top:8px;">ช่าง <span id="barberIncome">0</span></div>
      <div style="font-size:13px;">ร้าน <span id="shopIncome">0</span></div>
    </div>
  </div>

  <div class="card" style="text-align:center">
    <div id="clearStatus" class="big-number"></div>
  </div>

  <div class="card">
    <div id="todayList"></div>
    <button class="btn-red" style="width:100%; margin-top: 10px;" onclick="deleteToday()">ลบข้อมูลวันนี้</button>
  </div>

  <button class="btn-blue" style="width:100%" onclick="goPage(3)">ไปดูย้อนหลัง / สถิติ</button>
</div>

<div class="page" id="page3">
  <div class="card">
    <label>เลือกวันที่</label>
    <input type="date" id="historyDate" onchange="renderHistory()">
  </div>
  <div id="historyResult"></div>
</div>

<div class="modal" id="settingModal" onclick="if(event.target == this) this.style.display='none'">
  <div class="modal-content">
    <h3 style="margin-top:0">ตั้งค่าระบบ</h3>
    <label>ชื่อร้าน</label>
    <input id="shopInput">
    <label>% คอมมิชชั่น</label>
    <input type="number" id="percentInput">
    <label>รายได้ประกัน</label>
    <input type="number" id="guaranteeInput">
    <br><br>
    <button class="btn-green" style="width:100%" onclick="saveSetting()">บันทึก</button>
  </div>
</div>

<div class="footer-nav">
  <button id="nav1" onclick="goPage(1)" class="active">บันทึก</button>
  <button id="nav2" onclick="goPage(2)">รายวัน</button>
  <button id="nav3" onclick="goPage(3)">ย้อนหลัง</button>
</div>

<script>
/* ====== DATA ====== */
let payType="";
let setting=JSON.parse(localStorage.getItem("setting"))||{
  shop:"ร้านตัดผม",
  percent:50,
  guarantee:0
};

// Initial Load
document.getElementById("shopName").innerText=setting.shop;
document.getElementById("dateInput").value = new Date().toISOString().slice(0, 10);
document.getElementById("historyDate").value = new Date().toISOString().slice(0, 10);

/* ====== PAGE ====== */
function goPage(n){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.querySelectorAll(".footer-nav button").forEach(b=>b.classList.remove("active"));
  document.getElementById("page"+n).classList.add("active");
  document.getElementById("nav"+n).classList.add("active");
  if(n===2) renderDaily();
  if(n===3) renderHistory();
}

/* ====== RECORD ====== */
function setPay(p){
  payType=p;
  const cashBtn = document.getElementById("cashBtn");
  const transferBtn = document.getElementById("transferBtn");
  cashBtn.style.background=p==="เงินสด"?"#d1fae5":"#fff";
  transferBtn.style.background=p==="โอนเงิน"?"#dbeafe":"#fff";
}

function saveRecord(){
  const dateInput = document.getElementById("dateInput");
  const priceInput = document.getElementById("price");
  const serviceInput = document.getElementById("service");
  const hairInput = document.getElementById("hair");

  if(!payType) return alert("เลือกวิธีชำระเงิน");
  if(!priceInput.value) return alert("กรุณาใส่ราคา");

  const rec={
    id: Date.now(),
    date: dateInput.value,
    price: +priceInput.value,
    pay: payType,
    service: serviceInput.value,
    hair: hairInput.value
  };

  const arr=JSON.parse(localStorage.getItem("records")||"[]");
  arr.push(rec);
  localStorage.setItem("records",JSON.stringify(arr));
  
  alert("บันทึกสำเร็จ");
  
  // Clear Input
  priceInput.value=""; 
  setPay("");
}

/* ====== DAILY ====== */
function renderDaily(){
  const today = document.getElementById("dateInput").value;
  const arr = JSON.parse(localStorage.getItem("records")||"[]").filter(r=>r.date===today);
  
  let sum=0, transfer=0, extra=0;
  let listHtml = "";

  arr.forEach(r=>{
    sum += r.price;
    if(r.pay==="โอนเงิน") transfer += r.price;
    if(["โกนหนวด","สระผม","ย้อมผม","ดัดผม"].includes(r.service)) extra++;
    
    listHtml += `<div class="record-row">
      <span>${r.service} ${r.hair?'('+r.hair+')':''}</span>
      <span style="color:${r.pay==='เงินสด'?'#16a34a':'#2563eb'}">${r.pay} ฿${r.price}</span>
    </div>`;
  });

  const barber = Math.max(sum * (setting.percent / 100), setting.guarantee);
  const shop = sum - barber;

  document.getElementById("dailyDate").innerText = today;
  document.getElementById("sumTotal").innerText = sum.toLocaleString();
  document.getElementById("sumCount").innerText = arr.length;
  document.getElementById("extraCount").innerText = extra;
  document.getElementById("sumTransfer").innerText = transfer.toLocaleString();
  document.getElementById("barberIncome").innerText = barber.toLocaleString();
  document.getElementById("shopIncome").innerText = shop.toLocaleString();
  document.getElementById("todayList").innerHTML = listHtml || "<p style='text-align:center;color:#999'>ไม่มีข้อมูล</p>";

  const clearStatus = document.getElementById("clearStatus");
  let diff = transfer - barber;
  
  if(sum === 0) {
    clearStatus.innerText = "ไม่มีรายการ";
    clearStatus.className = "big-number status-equal";
  } else if(diff > 0) {
    clearStatus.innerText = "ช่างคืนร้าน ฿" + Math.abs(diff).toLocaleString();
    clearStatus.className = "big-number status-back";
  } else if(diff < 0) {
    clearStatus.innerText = "ร้านคืนช่าง ฿" + Math.abs(diff).toLocaleString();
    clearStatus.className = "big-number status-ok";
  } else {
    clearStatus.innerText = "ยอดพอดีไม่ต้องคืน";
    clearStatus.className = "big-number status-equal";
  }
}

/* ====== HISTORY ====== */
function renderHistory(){
  const hDate = document.getElementById("historyDate").value;
  const arr = JSON.parse(localStorage.getItem("records")||"[]").filter(r=>r.date===hDate);
  let html = "";
  let daySum = 0;

  arr.forEach(r=>{
    daySum += r.price;
    html += `<div class="record-row">
      <span>${r.service} ${r.hair?'('+r.hair+')':''}</span>
      <strong>฿${r.price}</strong>
    </div>`;
  });

  document.getElementById("historyResult").innerHTML = arr.length ? `
    <div class="card">
      <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
        <b>ยอดรวมวันที่เลือก</b>
        <b class="status-ok">฿${daySum.toLocaleString()}</b>
      </div>
      ${html}
    </div>
  ` : "<p style='text-align:center; padding:20px; color:#999'>ไม่พบข้อมูลในวันนี้</p>";
}

function deleteToday(){
  if(!confirm("ยืนยันการลบข้อมูลทั้งหมดของวันนี้?")) return;
  const today = document.getElementById("dateInput").value;
  let arr = JSON.parse(localStorage.getItem("records")||"[]");
  arr = arr.filter(r=>r.date !== today);
  localStorage.setItem("records", JSON.stringify(arr));
  renderDaily();
}

/* ====== SETTING ====== */
function openSetting(){
  document.getElementById("settingModal").style.display="flex";
  document.getElementById("shopInput").value=setting.shop;
  document.getElementById("percentInput").value=setting.percent;
  document.getElementById("guaranteeInput").value=setting.guarantee;
}

function saveSetting(){
  setting={
    shop: document.getElementById("shopInput").value,
    percent: +document.getElementById("percentInput").value,
    guarantee: +document.getElementById("guaranteeInput").value
  };
  localStorage.setItem("setting",JSON.stringify(setting));
  document.getElementById("shopName").innerText=setting.shop;
  document.getElementById("settingModal").style.display="none";
}
</script>

</body>
</html>
