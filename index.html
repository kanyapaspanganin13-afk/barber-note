<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Barber Note">
    <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
    <title>Barber Note v3 FINAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <style>
        :root {
            --primary: #2d46b9; --primary-light: #3e59d1; --bg: #f8faff;
            --card: #ffffff; --accent: #10b981; --danger: #ef4444;
            --warning: #f59e0b; --muted: #64748b;
        }
        body { margin: 0; font-family: 'Kanit', sans-serif; background: var(--bg); color: #1e293b; padding-bottom: 90px; }
        header { padding: 15px 16px; background: white; display: flex; justify-content: flex-end; align-items: center; gap: 10px; border-bottom: 1px solid #eee; }
        header h1 { font-size: 20px; margin: 0; color: var(--primary); flex-grow: 1; text-align: left; }
        .page { display: none; padding: 16px; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
        .card { background: var(--card); border-radius: 20px; padding: 18px; margin-bottom: 15px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .summary-main { background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%); color: white; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
        label { font-size: 13px; font-weight: 600; color: var(--muted); margin-bottom: 6px; display: block; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid #e2e8f0; font-size: 16px; box-sizing: border-box; background: #fff; }
        button { border: none; border-radius: 12px; padding: 12px; font-size: 15px; cursor: pointer; font-family: 'Kanit'; font-weight: 600; }
        .btn-main { background: var(--primary); color: white; width: 100%; }
        .btn-pay { background: white; border: 2px solid #e2e8f0; color: var(--muted); }
        .btn-pay.active-cash { border-color: var(--warning); color: var(--warning); background: #fffcf5; }
        .btn-pay.active-transfer { border-color: var(--primary); color: var(--primary); background: #f5f7ff; }
        .settlement-bar { padding: 12px; border-radius: 15px; text-align: center; font-weight: 700; font-size: 18px; margin: 10px 0; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f1f5f9; }
        .footer-nav { position: fixed; bottom: 0; left: 0; right: 0; background: white; display: flex; border-top: 1px solid #f1f5f9; padding-bottom: 10px; }
        .nav-item { flex: 1; text-align: center; padding: 12px; color: #cbd5e1; font-size: 12px; }
        .nav-item.active { color: var(--primary); }
        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 1000; }
        .modal-content { background: white; width: 85%; border-radius: 20px; padding: 20px; }
    </style>
</head>
<body>

<header>
    <h1 id="shopNameDisp">‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏°</h1>
    <button onclick="toggleModal(true)" style="background:none; color:var(--muted); font-size:20px; padding:0"><i class="fas fa-cog"></i></button>
</header>

<div class="page active" id="p1">
    <div class="card">
        <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
        <input type="date" id="dateInp">
        <div class="grid-2" style="margin-top:10px">
            <div><label>‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="time" id="t1" value="09:00"></div>
            <div><label>‡∏à‡∏ö</label><input type="time" id="t2" value="09:30"></div>
        </div>
    </div>
    <div class="card">
        <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ & ‡∏ó‡∏£‡∏á‡∏ú‡∏°</label>
        <div class="grid-2">
            <select id="svcInp">
                <option>‡∏ï‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
            <select id="hairInp">
                <option value="">‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ó‡∏£‡∏á</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à</option><option>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
            </select>
        </div>
        <label style="margin-top:10px">‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:20px; font-weight:700">
    </div>
    <div class="card">
        <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
        <div class="grid-2">
            <button id="bCash" class="btn-pay" onclick="setPay('‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î')">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="bTrans" class="btn-pay" onclick="setPay('‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô')">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
    </div>
    <button id="saveBtn" class="btn-main" onclick="saveData()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div class="page" id="p2">
    <div style="text-align:center; margin-bottom:15px">
        <h2 id="dailyTitle" style="margin:0; color:var(--primary)"></h2>
    </div>
    <div class="grid-2">
        <div class="card summary-main">
            <label style="color:rgba(255,255,255,0.8)">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</label>
            <div style="font-size:32px; font-weight:700">‡∏ø<span id="sumTotal">0</span></div>
            <div style="font-size:13px; margin-top:10px">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span id="countCust">0</span> | ‡πÄ‡∏û‡∏¥‡πà‡∏° <span id="countExtra">0</span></div>
        </div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; margin-bottom:8px">
                <span style="color:var(--muted); font-size:12px">‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô</span>
                <span style="font-weight:600" id="sumTrans">0</span>
            </div>
            <div style="display:flex; justify-content:space-between; margin-bottom:8px">
                <span style="color:var(--muted); font-size:12px">‡∏ä‡πà‡∏≤‡∏á</span>
                <span style="font-weight:600" id="incBarber">0</span>
            </div>
            <div style="display:flex; justify-content:space-between">
                <span style="color:var(--muted); font-size:12px">‡∏£‡πâ‡∏≤‡∏ô</span>
                <span style="font-weight:700; color:var(--accent)" id="incShop">0</span>
            </div>
        </div>
    </div>
    <div id="clearBar" class="settlement-bar">‚ö™Ô∏è ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô</div>
    <div class="card">
        <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label>
        <div id="dailyList"></div>
        <button class="btn-pay" style="width:100%; margin-top:15px; color:var(--danger)" onclick="delDay()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>
    <button class="btn-main" style="background:#06C755" onclick="shareLine()"><i class="fab fa-line"></i> ‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô LINE</button>
</div>

<div class="page" id="p3">
    <div class="card">
        <label>‡∏î‡∏π‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
        <input type="date" id="histDate" onchange="renderHist()">
    </div>
    <div id="histResult"></div>
    <div class="card" style="background:#f1f5f9">
        <label>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</label>
        <input type="month" id="histMonth" onchange="renderMonth()">
        <div id="monthResult" style="margin-top:15px"></div>
    </div>
</div>

<div class="footer-nav">
    <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-plus-circle"></i><br>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
    <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-chart-bar"></i><br>‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
    <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i><br>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>
</div>

<div class="modal" id="setModal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡πâ‡∏≤‡∏ô</h3>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label><input id="setShop">
        <label style="margin-top:10px">% ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</label><input type="number" id="setPerc">
        <label style="margin-top:10px">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô</label><input type="number" id="setGuar">
        <div class="grid-2" style="margin-top:20px">
            <button class="btn-pay" onclick="toggleModal(false)">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
            <button class="btn-main" onclick="saveSet()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        </div>
    </div>
</div>

<script>
    let payType = "";
    let conf = JSON.parse(localStorage.getItem("bn_conf")) || {shop:"‡∏£‡πâ‡∏≤‡∏ô‡∏ï‡∏±‡∏î‡∏ú‡∏°", perc:50, guar:0};

    window.onload = () => {
        document.getElementById("dateInp").valueAsDate = new Date();
        document.getElementById("shopNameDisp").innerText = conf.shop;
    };

    function go(n) {
        document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i=>i.classList.remove('active'));
        document.getElementById('p'+n).classList.add('active');
        document.getElementById('n'+n).classList.add('active');
        if(n===2) renderDaily();
    }

    function setPay(t) {
        payType = t;
        document.getElementById("bCash").className = t==='‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' ? 'btn-pay active-cash' : 'btn-pay';
        document.getElementById("bTrans").className = t==='‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' ? 'btn-pay active-transfer' : 'btn-pay';
    }

    function toggleModal(s) { document.getElementById("setModal").style.display = s ? "flex" : "none"; }
    
    function saveSet() {
        conf = {shop: document.getElementById("setShop").value, perc: +document.getElementById("setPerc").value, guar: +document.getElementById("setGuar").value};
        localStorage.setItem("bn_conf", JSON.stringify(conf));
        document.getElementById("shopNameDisp").innerText = conf.shop;
        toggleModal(false);
    }

    function saveData() {
        const p = document.getElementById("priceInp").value;
        if(!p || !payType) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏à‡πà‡∏≤‡∏¢");
        const rec = {
            id: Date.now(), date: document.getElementById("dateInp").value,
            svc: document.getElementById("svcInp").value, hair: document.getElementById("hairInp").value,
            price: +p, pay: payType, time: document.getElementById("t1").value
        };
        let db = JSON.parse(localStorage.getItem("bn_db")) || [];
        db.push(rec);
        localStorage.setItem("bn_db", JSON.stringify(db));
        
        const b = document.getElementById("saveBtn");
        b.style.background = "var(--accent)"; b.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à";
        setTimeout(() => {
            b.style.background = "var(--primary)"; b.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•";
            document.getElementById("priceInp").value = "";
            setPay("");
        }, 1000);
    }

    function renderDaily() {
        const today = document.getElementById("dateInp").value;
        const db = (JSON.parse(localStorage.getItem("bn_db")) || []).filter(r => r.date === today);
        let total = 0, trans = 0, extra = 0;
        let html = "";
        
        db.forEach(r => {
            total += r.price;
            if(r.pay === "‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô") trans += r.price;
            if(["‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î","‡∏™‡∏£‡∏∞‡∏ú‡∏°","‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°"].includes(r.svc)) extra++;
            html += `<div class="list-item">
                <div style="font-size:14px"><b>${r.svc}</b> ${r.hair}<br><small style="color:var(--muted)">${r.time} | ${r.pay}</small></div>
                <div>‡∏ø${r.price} <i class="fas fa-trash" style="color:#cbd5e1; margin-left:10px" onclick="delRec(${r.id})"></i></div>
            </div>`;
        });

        const barber = Math.max(total * (conf.perc/100), conf.guar);
        const shop = total - barber;
        const diff = trans - shop;

        document.getElementById("dailyTitle").innerText = new Date(today).toLocaleDateString('th-TH',{day:'numeric',month:'long'});
        document.getElementById("sumTotal").innerText = total.toLocaleString();
        document.getElementById("sumTrans").innerText = trans.toLocaleString();
        document.getElementById("countCust").innerText = db.length;
        document.getElementById("countExtra").innerText = extra;
        document.getElementById("incBarber").innerText = barber.toLocaleString();
        document.getElementById("incShop").innerText = shop.toLocaleString();
        document.getElementById("dailyList").innerHTML = html || "<center style='color:#ccc;padding:20px'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";

        const bar = document.getElementById("clearBar");
        if(total === 0) { bar.innerText = "‚ö™Ô∏è ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô"; bar.style.background = "#f1f5f9"; bar.style.color = "#64748b"; }
        else if(diff > 0) { bar.innerText = "üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø"+diff; bar.style.background = "#fef2f2"; bar.style.color = "#ef4444"; }
        else if(diff < 0) { bar.innerText = "üü© ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø"+Math.abs(diff); bar.style.background = "#f0fdf4"; bar.style.color = "#10b981"; }
        else { bar.innerText = "‚ö™Ô∏è ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô"; bar.style.background = "#f0f9ff"; bar.style.color = "#3b82f6"; }
    }

    function delRec(id) {
        let db = JSON.parse(localStorage.getItem("bn_db")) || [];
        db = db.filter(r => r.id !== id);
        localStorage.setItem("bn_db", JSON.stringify(db));
        renderDaily();
    }

    function delDay() {
        if(!confirm("‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?")) return;
        let db = JSON.parse(localStorage.getItem("bn_db")) || [];
        const today = document.getElementById("dateInp").value;
        db = db.filter(r => r.date !== today);
        localStorage.setItem("bn_db", JSON.stringify(db));
        renderDaily();
    }

    function renderHist() {
        const d = document.getElementById("histDate").value;
        const db = (JSON.parse(localStorage.getItem("bn_db")) || []).filter(r => r.date === d);
        let sum = 0;
        let html = db.map(r => { sum += r.price; return `<div class="list-item"><span>${r.svc} ${r.hair}</span><b>‡∏ø${r.price}</b></div>` }).join("");
        document.getElementById("histResult").innerHTML = `<div class="card"><label>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡∏±</label><div style="font-size:24px;font-weight:700;color:var(--primary)">‡∏ø${sum}</div>${html}</div>`;
    }

    function renderMonth() {
        const m = document.getElementById("histMonth").value;
        const db = (JSON.parse(localStorage.getItem("bn_db")) || []).filter(r => r.date.startsWith(m));
        let total = 0;
        db.forEach(r => total += r.price);
        document.getElementById("monthResult").innerHTML = `<b>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô:</b> <span style="font-size:20px;color:var(--accent)">‡∏ø${total.toLocaleString()}</span><br>‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î: ${db.length} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    }

    function shareLine() {
        const today = document.getElementById("dateInp").value;
        const db = (JSON.parse(localStorage.getItem("bn_db")) || []).filter(r => r.date === today);
        if(!db.length) return;
        let sum = 0, trans = 0;
        let detail = "";
        db.forEach((r,i) => { sum += r.price; if(r.pay==='‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô') trans += r.price; detail += `${i+1}. ${r.svc} ${r.hair} (${r.price})\n`; });
        const barber = Math.max(sum * (conf.perc/100), conf.guar);
        const shop = sum - barber;
        const diff = trans - shop;
        const status = diff > 0 ? "üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô" : diff < 0 ? "üü© ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á" : "‚ö™Ô∏è ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ";
        const msg = `üìå ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${today}\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${sum}\n‚úÇÔ∏è ‡∏ä‡πà‡∏≤‡∏á: ${barber}\nüè† ‡∏£‡πâ‡∏≤‡∏ô: ${shop}\n\nüí≥ ‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô: ${trans}\nüîÑ ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: ${status} ‡∏ø${Math.abs(diff)}\n\nüìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:\n${detail}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }
</script>
</body>
</html>
