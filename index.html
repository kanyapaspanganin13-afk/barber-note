<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Barber Note v3 FINAL</title>

<!-- ICON / LINE SHARE -->
<link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/4/41/LINE_logo.svg">

<style>
:root{
  --bg:#f4f6f8;
  --card:#ffffff;
  --main:#111;
  --sub:#555;
  --green:#16a34a;
  --red:#dc2626;
  --blue:#2563eb;
  --orange:#ea580c;
}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--main);
}
header{
  padding:12px 16px;
  background:#fff;
  display:flex;
  align-items:center;
  justify-content:space-between;
  border-bottom:1px solid #e5e7eb;
}
h1{
  font-size:18px;
  margin:0;
}
button{
  border:none;
  border-radius:8px;
  padding:10px;
  font-size:14px;
}
.btn-main{background:var(--blue);color:#fff;}
.btn-line{background:#06c755;color:#fff;}
.btn-danger{background:var(--red);color:#fff;}
.btn-gray{background:#e5e7eb;}

.page{display:none;padding:16px;}
.page.active{display:block;}

.card{
  background:var(--card);
  border-radius:14px;
  padding:14px;
  margin-bottom:12px;
}

.grid2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
}

.big{
  font-size:22px;
  font-weight:700;
}
.mid{
  font-size:16px;
  font-weight:600;
}

input,select{
  width:100%;
  padding:10px;
  border-radius:8px;
  border:1px solid #d1d5db;
  font-size:14px;
}

.list{
  border-top:1px dashed #ddd;
  padding-top:8px;
  margin-top:8px;
  font-size:13px;
}

.status-ok{color:var(--green);font-weight:700;}
.status-pay{color:var(--red);font-weight:700;}
.status-back{color:var(--orange);font-weight:700;}

footer{
  position:fixed;
  bottom:0;
  left:0;
  right:0;
  display:flex;
  background:#fff;
  border-top:1px solid #e5e7eb;
}
footer button{
  flex:1;
  border-radius:0;
}
</style>
</head>

<body>

<header>
  <h1 id="shopName">Barber Note</h1>
  <button onclick="openSetting()">‚öôÔ∏è</button>
</header>

<!-- PAGE 1 : RECORD -->
<div class="page active" id="page1">
  <div class="card">
    <label>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</label>
    <input type="date" id="recDate">
    <label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label>
    <input type="time" id="startTime">
    <label>‡πÄ‡∏ß‡∏•‡∏≤‡∏™‡∏¥‡πâ‡∏ô‡∏™‡∏∏‡∏î</label>
    <input type="time" id="endTime">
  </div>

  <div class="card">
    <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
    <select id="service">
      <option>‡∏ï‡∏±‡∏î‡∏ú‡∏°</option>
      <option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option>
      <option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option>
      <option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option>
      <option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option>
      <option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option>
      <option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option>
      <option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option>
      <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
    </select>

    <label>‡∏ó‡∏£‡∏á‡∏ú‡∏°</label>
    <select id="style">
      <option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option>
      <option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option>
      <option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option>
      <option>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
      <option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à / ‡∏ó‡∏´‡∏≤‡∏£</option>
      <option>‡∏ó‡∏£‡∏á‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏±‡∏ô</option>
      <option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option>
      <option>‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à</option>
      <option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
    </select>

    <label>‡∏£‡∏≤‡∏Ñ‡∏≤ (‡∏ö‡∏≤‡∏ó)</label>
    <input type="number" id="price">
  </div>

  <div class="card">
    <label>‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</label>
    <select id="payType">
      <option value="cash">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</option>
      <option value="transfer">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</option>
    </select>
  </div>

  <button class="btn-main" style="width:100%" onclick="saveRecord()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<!-- PAGE 2 : DAILY REPORT -->
<div class="page" id="page2">
  <div class="card" style="text-align:center">
    <div class="mid" id="reportDate"></div>
  </div>

  <div class="grid2">
    <div class="card">
      <div>‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div>
      <div class="big" id="sumTotal">0</div>
      <div>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span id="sumCustomer">0</span> ‡∏Ñ‡∏ô</div>
      <div id="extraCount"></div>
    </div>

    <div class="card">
      <div>‡∏¢‡∏≠‡∏î‡πÇ‡∏≠‡∏ô</div>
      <div class="mid" id="sumTransfer">0</div>
      <div>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á <span id="barberIncome">0</span></div>
      <div>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô <span id="shopIncome">0</span></div>
    </div>
  </div>

  <div class="card">
    ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ :
    <span id="clearStatus"></span>
  </div>

  <div class="card">
    <div class="mid">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
    <div id="todayList"></div>
    <button class="btn-danger" onclick="deleteToday()">‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
  </div>

  <button class="btn-line" style="width:100%" onclick="shareLine()">‡∏™‡πà‡∏á‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡πÑ‡∏õ LINE</button>
</div>

<!-- PAGE 3 : HISTORY -->
<div class="page" id="page3">
  <div class="card">
    <label>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏±‡∏ô</label>
    <input type="date" id="hisDate" onchange="loadHistory()">
  </div>
  <div id="historyBox"></div>
</div>

<footer>
  <button onclick="showPage(1)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  <button onclick="showPage(2)">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
  <button onclick="showPage(3)">‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</button>
</footer>

<script>
/* ====== SETTING ====== */
let setting={
  commission:50,
  guarantee:1000
};

/* ====== PAGE CONTROL ====== */
function showPage(n){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.getElementById('page'+n).classList.add('active');
  if(n===2) loadReport();
}

/* ====== SAVE RECORD ====== */
function saveRecord(){
  const rec={
    date:recDate.value,
    service:service.value,
    style:style.value,
    price:+price.value,
    pay:payType.value
  };
  const data=JSON.parse(localStorage.getItem('records')||'[]');
  data.push(rec);
  localStorage.setItem('records',JSON.stringify(data));
  alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à');
  price.value='';
}

/* ====== REPORT ====== */
function loadReport(){
  const today=new Date().toISOString().slice(0,10);
  reportDate.innerText=new Date(today).toLocaleDateString('th-TH');
  const data=JSON.parse(localStorage.getItem('records')||'[]')
    .filter(r=>r.date===today);

  let total=0,transfer=0;
  data.forEach(r=>{
    total+=r.price;
    if(r.pay==='transfer') transfer+=r.price;
  });

  let barber=Math.max(total*setting.commission/100,setting.guarantee);
  let shop=total-barber;

  sumTotal.innerText=total;
  sumCustomer.innerText=data.length;
  sumTransfer.innerText=transfer;
  barberIncome.innerText=barber;
  shopIncome.innerText=shop;

  if(shop>0) clearStatus.innerText='‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô',clearStatus.className='status-pay';
  else if(shop<0) clearStatus.innerText='‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á',clearStatus.className='status-back';
  else clearStatus.innerText='‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Ñ‡∏∑‡∏ô',clearStatus.className='status-ok';

  todayList.innerHTML=data.map(r=>`‚Ä¢ ${r.service} ${r.price} (${r.pay})`).join('<br>');
}

/* ====== LINE SHARE ====== */
function shareLine(){
  const msg=
`üìä ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô
‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏° ${sumTotal.innerText} ‡∏ö‡∏≤‡∏ó
‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ ${sumCustomer.innerText} ‡∏Ñ‡∏ô
‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á ${barberIncome.innerText}
‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô ${shopIncome.innerText}
‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ ${clearStatus.innerText}`;
  location.href=`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`;
}

/* ====== HISTORY ====== */
function loadHistory(){
  const d=hisDate.value;
  const data=JSON.parse(localStorage.getItem('records')||'[]')
    .filter(r=>r.date===d);
  historyBox.innerHTML=data.map(r=>`
    <div class="card">
      ${r.service} - ${r.price} ‡∏ö‡∏≤‡∏ó (${r.pay})
    </div>
  `).join('');
}

/* ====== DELETE TODAY (TEST) ====== */
function deleteToday(){
  if(!confirm('‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ?'))return;
  const today=new Date().toISOString().slice(0,10);
  const data=JSON.parse(localStorage.getItem('records')||'[]')
    .filter(r=>r.date!==today);
  localStorage.setItem('records',JSON.stringify(data));
  loadReport();
}
</script>
</body>
</html>
