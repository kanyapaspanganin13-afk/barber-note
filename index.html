<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Barber Note v3 FINAL</title>

<!-- โลโก้สำหรับติดตั้งเป็นแอป -->
<link rel="apple-touch-icon" href="https://i.imgur.com/8Km9tLL.png">

<style>
:root{
  --primary:#111827;
  --bg:#f5f7fb;
  --card:#ffffff;
  --accent:#16a34a;
  --danger:#dc2626;
  --info:#2563eb;
  --muted:#6b7280;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;
  background:var(--bg);
  color:var(--primary);
}

header{
  padding:12px 16px;
  background:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px solid #e5e7eb;
}

header h1{
  font-size:18px;
  margin:0;
}

button{
  border:none;
  border-radius:10px;
  padding:10px 14px;
  font-size:15px;
}

.btn-primary{background:#111827;color:#fff;}
.btn-green{background:var(--accent);color:#fff;}
.btn-blue{background:var(--info);color:#fff;}
.btn-red{background:var(--danger);color:#fff;}
.btn-outline{background:#fff;border:1px solid #d1d5db;}

.page{display:none;padding:14px;}
.page.active{display:block;}

.card{
  background:var(--card);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
  box-shadow:0 4px 10px rgba(0,0,0,.05);
}

.grid-2{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
}

label{font-size:13px;color:var(--muted);}
input,select{
  width:100%;
  padding:10px;
  border-radius:10px;
  border:1px solid #d1d5db;
  font-size:15px;
}

.big-number{
  font-size:22px;
  font-weight:700;
}

.status-ok{color:#16a34a;}
.status-back{color:#dc2626;}
.status-equal{color:#6b7280;}

.record-row{
  display:flex;
  justify-content:space-between;
  align-items:center;
  border-bottom:1px dashed #e5e7eb;
  padding:6px 0;
  font-size:14px;
}

.footer-nav{
  position:fixed;
  bottom:0;left:0;right:0;
  background:#fff;
  display:flex;
  border-top:1px solid #e5e7eb;
}
.footer-nav button{
  flex:1;
  border-radius:0;
  padding:14px;
  background:#fff;
}

.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.4);
  display:none;
  align-items:center;
  justify-content:center;
}
.modal-content{
  background:#fff;
  width:90%;
  border-radius:16px;
  padding:16px;
}
</style>
</head>

<body>

<!-- HEADER -->
<header>
  <h1 id="shopName">ร้านตัดผม</h1>
  <button class="btn-outline" onclick="openSetting()">⚙️</button>
</header>

<!-- PAGE 1 RECORD -->
<div class="page active" id="page1">
  <div class="card">
    <label>วันที่</label>
    <input type="date" id="dateInput">

    <div class="grid-2">
      <div>
        <label>เวลาเริ่ม</label>
        <input type="time" id="startTime">
      </div>
      <div>
        <label>เวลาสิ้นสุด</label>
        <input type="time" id="endTime">
      </div>
    </div>
  </div>

  <div class="card">
    <label>บริการ</label>
    <select id="service">
      <option value="ตัดผม">ตัดผม</option>
      <option value="โกนหนวด">โกนหนวด</option>
      <option value="กันหน้า">กันหน้า</option>
      <option value="แก้ผม">แก้ผม</option>
      <option value="โกนผม">โกนผม</option>
      <option value="สระผม">สระผม</option>
      <option value="ย้อมผม">ย้อมผม</option>
      <option value="ดัดผม">ดัดผม</option>
      <option value="อื่นๆ">อื่นๆ</option>
    </select>

    <label>ทรงผม</label>
    <select id="hair">
      <option value="">ไม่ระบุ</option>
      <option>รองทรง</option>
      <option>สกินเฟด</option>
      <option>แฟชั่น</option>
      <option>นักเรียน</option>
      <option>ตำรวจ / ทหาร</option>
      <option>ทรงอเมริกัน</option>
      <option>เปิดข้าง</option>
      <option>วินเทจ</option>
      <option>อื่นๆ</option>
    </select>

    <label>ราคา</label>
    <input type="number" id="price">
  </div>

  <div class="card">
    <label>วิธีชำระเงิน</label>
    <div class="grid-2">
      <button id="cashBtn" class="btn-outline" onclick="setPay('เงินสด')">เงินสด</button>
      <button id="transferBtn" class="btn-outline" onclick="setPay('โอนเงิน')">โอนเงิน</button>
    </div>
  </div>

  <button class="btn-primary" style="width:100%" onclick="saveRecord()">บันทึกข้อมูล</button>
</div>

<!-- PAGE 2 DAILY -->
<div class="page" id="page2">
  <div class="card" style="text-align:center">
    <div id="dailyDate" class="big-number"></div>
  </div>

  <div class="grid-2">
    <div class="card">
      <div>ยอดรวม</div>
      <div id="sumTotal" class="big-number"></div>
      <div>ลูกค้า <span id="sumCount"></span> คน</div>
      <div>บริการเพิ่ม <span id="extraCount"></span></div>
    </div>

    <div class="card">
      <div>ยอดโอน</div>
      <div id="sumTransfer" class="big-number"></div>
      <div>รายได้ช่าง <span id="barberIncome"></span></div>
      <div>รายได้ร้าน <span id="shopIncome"></span></div>
    </div>
  </div>

  <div class="card">
    <div id="clearStatus" class="big-number"></div>
  </div>

  <div class="card">
    <div id="todayList"></div>
    <button class="btn-red" style="width:100%" onclick="deleteToday()">ลบข้อมูลวันนี้</button>
  </div>

  <button class="btn-blue" style="width:100%" onclick="goPage(3)">ไปดูย้อนหลัง / สถิติ</button>
</div>

<!-- PAGE 3 HISTORY -->
<div class="page" id="page3">
  <div class="card">
    <label>เลือกวันที่</label>
    <input type="date" id="historyDate" onchange="renderHistory()">
  </div>
  <div id="historyResult"></div>
</div>

<!-- SETTING MODAL -->
<div class="modal" id="settingModal">
  <div class="modal-content">
    <label>ชื่อร้าน</label>
    <input id="shopInput">
    <label>% คอมมิชชั่น</label>
    <input type="number" id="percentInput">
    <label>รายได้ประกัน</label>
    <input type="number" id="guaranteeInput">
    <button class="btn-green" style="width:100%" onclick="saveSetting()">บันทึก</button>
  </div>
</div>

<!-- NAV -->
<div class="footer-nav">
  <button onclick="goPage(1)">บันทึก</button>
  <button onclick="goPage(2)">รายวัน</button>
  <button onclick="goPage(3)">ย้อนหลัง</button>
</div>

<script>
/* ====== DATA ====== */
let payType="";
let setting=JSON.parse(localStorage.getItem("setting"))||{
  shop:"ร้านตัดผม",
  percent:50,
  guarantee:0
};
document.getElementById("shopName").innerText=setting.shop;

/* ====== PAGE ====== */
function goPage(n){
  document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
  document.getElementById("page"+n).classList.add("active");
  if(n===2) renderDaily();
}

/* ====== RECORD ====== */
function setPay(p){
  payType=p;
  cashBtn.style.background=p==="เงินสด"?"#d1fae5":"#fff";
  transferBtn.style.background=p==="โอนเงิน"?"#dbeafe":"#fff";
}

function saveRecord(){
  if(!payType) return alert("เลือกวิธีชำระเงิน");
  const rec={
    date:dateInput.value,
    price:+price.value,
    pay:payType,
    service:service.value
  };
  const arr=JSON.parse(localStorage.getItem("records")||"[]");
  arr.push(rec);
  localStorage.setItem("records",JSON.stringify(arr));
  alert("บันทึกสำเร็จ");
  price.value=""; payType="";
}

/* ====== DAILY ====== */
function renderDaily(){
  const today=new Date().toISOString().slice(0,10);
  const arr=JSON.parse(localStorage.getItem("records")||"[]").filter(r=>r.date===today);
  let sum=0,transfer=0,extra=0;
  arr.forEach(r=>{
    sum+=r.price;
    if(r.pay==="โอนเงิน") transfer+=r.price;
    if(["โกนหนวด","สระผม","ย้อมผม"].includes(r.service)) extra++;
  });
  const barber=Math.max(sum*setting.percent/100,setting.guarantee);
  const shop=sum-barber;
  document.getElementById("sumTotal").innerText=sum;
  document.getElementById("sumCount").innerText=arr.length;
  document.getElementById("extraCount").innerText=extra;
  document.getElementById("sumTransfer").innerText=transfer;
  document.getElementById("barberIncome").innerText=barber;
  document.getElementById("shopIncome").innerText=shop;

  let diff=transfer-shop;
  clearStatus.innerText=diff>0?"ร้านคืนช่าง":diff<0?"ช่างคืนร้าน":"ยอดพอดีไม่ต้องคืน";
}

/* ====== SETTING ====== */
function openSetting(){
  settingModal.style.display="flex";
  shopInput.value=setting.shop;
  percentInput.value=setting.percent;
  guaranteeInput.value=setting.guarantee;
}
function saveSetting(){
  setting={
    shop:shopInput.value,
    percent:+percentInput.value,
    guarantee:+guaranteeInput.value
  };
  localStorage.setItem("setting",JSON.stringify(setting));
  shopName.innerText=setting.shop;
  settingModal.style.display="none";
}
</script>

</body>
</html>
