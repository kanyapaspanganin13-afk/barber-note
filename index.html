<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
    <title>Barber Note v3.4 Final Draft</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #1e3a8a; --accent: #16a34a; --danger: #dc2626; --warning: #f59e0b;
            --main-bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --input-bg: #f8fafc;
            --indigo: #818cf8;
        }
        body.theme-dark { --main-bg: #0f172a; --card: #1e293b; --text: #f8fafc; --input-bg: #334155; }
        body.theme-pastel { --main-bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --input-bg: #f5f3ff; }

        body { margin: 0; font-family: 'Kanit', sans-serif; background: var(--main-bg); color: var(--text); padding-bottom: 90px; transition: 0.3s; font-weight: 300; }
        header { padding: 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
        header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }
        
        .page { display: none; padding: 15px; animation: fadeIn 0.2s; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .card { background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        
        label { font-size: 13px; font-weight: 500; opacity: 0.8; margin-bottom: 5px; display: block; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 16px; box-sizing: border-box; background: var(--input-bg); color: var(--text); outline: none; font-family: 'Kanit'; }
        
        .time-input { text-align: center; font-weight: 500; letter-spacing: 1px; }
        .btn-pay { border: 2px solid transparent; background: var(--input-bg); color: var(--text); padding: 12px; border-radius: 12px; font-weight: 500; cursor: pointer; transition: 0.2s; }
        .btn-pay.active-cash { border-color: var(--warning); color: var(--warning); background: #fffbeb; }
        .btn-pay.active-transfer { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
        
        .status-bar { width: 100%; padding: 15px; border-radius: 15px; text-align: center; font-weight: 600; font-size: 16px; margin: 10px 0; box-sizing: border-box; }
        .status-red { background: #fee2e2; color: #dc2626; }
        .status-green { background: #dcfce7; color: #16a34a; }
        .status-blue { background: #e0f2fe; color: #0284c7; }
        .status-indigo { background: #e0e7ff; color: #4338ca; }

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid rgba(0,0,0,0.05); padding-bottom: env(safe-area-inset-bottom); }
        .nav-item { flex: 1; text-align: center; padding: 12px; color: #94a3b8; font-size: 12px; }
        .nav-item.active { color: var(--primary); font-weight: 600; }
        .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

        .btn-save { background: var(--primary); color: white; width: 100%; padding: 16px; border-radius: 16px; font-size: 18px; font-weight: 600; border: none; margin-top: 10px; cursor: pointer; }
        .btn-close-day { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; border-radius: 30px; background: #818cf8; color: white; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 99; font-size: 24px; cursor: pointer; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
        .modal-content { background: var(--card); width: 100%; border-radius: 25px; padding: 22px; max-height: 85vh; overflow-y: auto; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°‡∏ß‡∏á‡∏Å‡∏•‡∏°‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏µ‡∏ó‡∏µ‡πà‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà */
        .color-dot {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #ddd;
            display: inline-block;
            transition: 0.2s;
        }
        .color-dot:hover { transform: scale(1.1); border-color: #999; }
    </style>
</head>
<body id="mainBody">

<header>
    <div style="width:40px"></div>
    <h1 id="shopNameDisp">Barber Note</h1>
    <div style="width:40px; text-align:right; cursor:pointer" onclick="openSettings()"><i class="fas fa-cog"></i></div>
</header>
   
<div id="p1" class="page active">
    <div class="card">
        <div style="display: flex; align-items: center; gap: 10px; margin-bottom:15px;">
            <i class="fas fa-calendar-day" style="color:var(--primary)"></i>
            <input type="date" id="dateInp" style="padding: 5px; background:none;">
        </div>
        <div class="grid-2">
            <div><label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="tel" id="tStart" placeholder="0900" class="time-input" maxlength="4"></div>
            <div><label>‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏™‡∏£‡πá‡∏à</label><input type="tel" id="tEnd" placeholder="0930" class="time-input" maxlength="4"></div>
        </div>
    </div>

    <div class="card">
        <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏´‡∏•‡∏±‡∏Å & ‡∏ó‡∏£‡∏á‡∏ú‡∏°</label>
        <div class="grid-2" style="margin-bottom:10px">
            <select id="mainSvc"><option value="">(‡πÑ‡∏°‡πà‡∏ï‡∏±‡∏î‡∏ú‡∏°)</option><option selected>‡∏ï‡∏±‡∏î‡∏ú‡∏°</option></select>
            <select id="hairStyle">
                <option value="">(‡πÑ‡∏°‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å)</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option>
                <option>‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á</option><option>‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à</option><option>‡∏ï‡∏≥‡∏£‡∏ß‡∏à/‡∏ó‡∏´‡∏≤‡∏£</option><option>‡∏ó‡∏£‡∏á‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
            </select>
        </div>
        <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô</label>
        <div class="grid-2">
            <select id="extraSvc1">
                <option value="">(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô)</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option>
                <option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option>
            </select>
            <select id="extraSvc2">
                <option value="">(‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡∏≠‡∏∑‡πà‡∏ô)</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option>
                <option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÇ‡∏Å‡∏ô‡∏ú‡∏°</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option>
            </select>
        </div>
    </div>

    <div class="card">
        <label>‡∏Ñ‡πà‡∏≤‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:40px; font-weight:600; color:var(--primary); text-align:center; background:var(--input-bg); height:80px;">
        <div class="grid-2" style="margin-top:15px">
            <button id="btnCash" class="btn-pay" onclick="selectPay('Cash')">üíµ ‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="btnTrans" class="btn-pay" onclick="selectPay('Trans')">üì± ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
    </div>
    <button class="btn-save" onclick="alert('‡∏£‡∏∞‡∏ö‡∏ö‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö JavaScript ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì')">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label><input id="setShop" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì">
        <div class="grid-2" style="margin-top:10px">
            <div><label>% ‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô</label><input type="number" id="setPerc" value="50"></div>
            <div><label>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label><input type="number" id="setGuar" value="0"></div>
        </div>
        <label style="margin-top:15px">‡πÇ‡∏´‡∏°‡∏î‡∏™‡∏µ</label>
        <select id="setTheme" onchange="changeTheme(this.value)">
            <option value="light">Light Mode</option>
            <option value="dark">Dark Mode</option>
            <option value="pastel">Pastel Mode</option>
        </select>
        <label style="margin-top:15px">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
        <div id="colorPicker" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;">
            <div class="color-dot" style="background:#fdf2f8" onclick="setBg('#fdf2f8')"></div>
            <div class="color-dot" style="background:#f0fdf4" onclick="setBg('#f0fdf4')"></div>
            <div class="color-dot" style="background:#f0f9ff" onclick="setBg('#f0f9ff')"></div>
            <div class="color-dot" style="background:#fffbeb" onclick="setBg('#fffbeb')"></div>
            <div class="color-dot" style="background:#f1f5f9" onclick="setBg('#f1f5f9')"></div>
            <div class="color-dot" style="background:#eef2ff" onclick="setBg('#eef2ff')"></div>
            <div class="color-dot" style="background:#fff7ed" onclick="setBg('#fff7ed')"></div>
        </div>
        
        <button class="btn-save" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤</button>
        <button onclick="closeSettings()" style="width:100%; margin-top:15px; border:none; background:none; color:#666; text-decoration:underline; cursor:pointer;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
    </div>
</div>

<script>
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏¥‡∏î-‡∏õ‡∏¥‡∏î Modal
    function openSettings() {
        document.getElementById("modalSet").style.display = "flex";
    }
    function closeSettings() {
        document.getElementById("modalSet").style.display = "none";
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
    function setBg(color) {
        document.body.style.backgroundColor = color;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô Theme (Light/Dark/Pastel)
    function changeTheme(val) {
        document.body.className = '';
        if(val !== 'light') document.body.classList.add('theme-' + val);
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤
    function saveSettings() {
        const shopName = document.getElementById("setShop").value;
        if(shopName) {
            document.getElementById("shopNameDisp").innerText = shopName;
        }
        alert("‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢!");
        closeSettings();
    }
    
    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô (‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á)
    function selectPay(type) {
        document.getElementById("btnCash").className = 'btn-pay' + (type==='Cash' ? ' active-cash' : '');
        document.getElementById("btnTrans").className = 'btn-pay' + (type==='Trans' ? ' active-transfer' : '');
    }
</script>

</body>
</html>
<nav class="nav">
    <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
    <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-calendar-check"></i>‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</div>
    <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>
</nav>

<script>
    let payMethod = "";
    let conf = JSON.parse(localStorage.getItem("barber_conf")) || {shop:"Barber Shop", perc:50, guar:0, theme:"light", bg:"#f1f5f9"};
    let db = JSON.parse(localStorage.getItem("barber_db")) || []; 
    let archives = JSON.parse(localStorage.getItem("barber_arc")) || []; 

    window.onload = () => {
        document.getElementById("dateInp").valueAsDate = new Date();
        applySettings();
    };

    // Auto Format Time HHMM -> HH:MM
    document.querySelectorAll('.time-input').forEach(inp => {
        inp.addEventListener('input', (e) => {
            let v = e.target.value.replace(/\D/g, '');
            if(v.length >= 4) {
                e.target.value = v.substring(0,2) + ":" + v.substring(2,4);
            }
        });
    });

    function go(n) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('p'+n).classList.add('active');
        document.getElementById('n'+n).classList.add('active');
        if(n===2) renderDay();
    }

    function selectPay(m) {
        payMethod = m;
        document.getElementById("btnCash").className = m==='Cash'?'btn-pay active-cash':'btn-pay';
        document.getElementById("btnTrans").className = m==='Trans'?'btn-pay active-transfer':'btn-pay';
    }

    function handleSave() {
        const p = document.getElementById("priceInp").value;
        if(!p || !payMethod) return alert("‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");

        const rec = {
            id: Date.now(),
            date: document.getElementById("dateInp").value,
            time: `${document.getElementById("tStart").value}-${document.getElementById("tEnd").value}`,
            svcs: [document.getElementById("mainSvc").value, document.getElementById("extraSvc1").value, document.getElementById("extraSvc2").value].filter(x => x!==""),
            hair: document.getElementById("hairStyle").value,
            price: Number(p),
            pay: payMethod
        };

        db.push(rec);
        localStorage.setItem("barber_db", JSON.stringify(db));
        
        const b = document.getElementById("mainSaveBtn");
        b.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß ‚úì"; b.style.background = "var(--accent)";
        if(window.navigator.vibrate) window.navigator.vibrate(50);

        setTimeout(() => {
            b.innerText = "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"; b.style.background = "var(--primary)";
            document.getElementById("priceInp").value = "";
            document.getElementById("tStart").value = document.getElementById("tEnd").value;
            document.getElementById("tEnd").value = "";
            selectPay("");
        }, 800);
    }

    function renderDay() {
        const d = document.getElementById("dateInp").value;
        const today = db.filter(r => r.date === d);
        let tot = 0, trans = 0, cash = 0, stats = {};
        let listHtml = "";

        today.sort((a,b) => b.id - a.id).forEach(r => {
            tot += r.price;
            if(r.pay==='Trans') trans += r.price; else cash += r.price;
            r.svcs.forEach(s => stats[s] = (stats[s]||0)+1);
            
            listHtml += `<div class="history-row">
                <div style="display:flex; justify-content:space-between; font-weight:500">
                    <span>${r.time} | ${r.svcs.join('+')}</span>
                    <span>‡∏ø${r.price}</span>
                </div>
                <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.7; margin-top:2px;">
                    <span>${r.hair ? '‡∏ó‡∏£‡∏á: '+r.hair : ''}</span>
                    <span>${r.pay==='Cash'?'üíµ ‡∏™‡∏î':'üì± ‡πÇ‡∏≠‡∏ô'} <i class="fas fa-trash" style="margin-left:10px" onclick="delRec(${r.id})"></i></span>
                </div>
            </div>`;
        });

        const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
        const sEarn = tot - bEarn;
        const settle = cash - bEarn;

        document.getElementById("dTotal").innerText = tot.toLocaleString();
        document.getElementById("dTrans").innerText = trans.toLocaleString();
        document.getElementById("dBarber").innerText = bEarn.toLocaleString();
        document.getElementById("dShop").innerText = sEarn.toLocaleString();
        document.getElementById("dShop").style.color = sEarn < 0 ? 'var(--danger)' : 'var(--accent)';
        document.getElementById("dCounts").innerText = `‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: ${today.length} ‡∏Ñ‡∏ô`;
        document.getElementById("dailyList").innerHTML = listHtml || "<center style='padding:40px; opacity:0.3'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>";
        
        let statHtml = "";
        for(let s in stats) { statHtml += `<span class="badge">${s}: ${stats[s]}</span>`; }
        document.getElementById("dServiceStats").innerHTML = statHtml;

        const bar = document.getElementById("settleBar");
        if(tot === 0) { bar.innerText = "üü¶ ‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ"; bar.className = "status-bar status-blue"; }
        else if(settle > 0) { bar.innerText = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${settle.toLocaleString()}`; bar.className = "status-bar status-red"; }
        else if(settle < 0) { bar.innerText = `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.abs(settle).toLocaleString()}`; bar.className = "status-bar status-indigo"; }
        else { bar.innerText = "üü¶ ‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏≠‡∏î‡∏µ"; bar.className = "status-bar status-blue"; }
    }

    function delRec(id) {
        if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            db = db.filter(r => r.id !== id);
            localStorage.setItem("barber_db", JSON.stringify(db));
            renderDay();
        }
    }

    function closeDay() {
        const d = document.getElementById("dateInp").value;
        const today = db.filter(r => r.date === d);
        if(!today.length) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

        if(confirm("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥?")) {
            const tot = today.reduce((a,b) => a+b.price, 0);
            const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
            const arc = {
                date: d, total: tot, barber: bEarn, shop: tot-bEarn, count: today.length, details: today,
                cash: today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price, 0)
            };
            archives = archives.filter(a => a.date !== d);
            archives.push(arc);
            localStorage.setItem("barber_arc", JSON.stringify(archives));
            db = db.filter(r => r.date !== d);
            localStorage.setItem("barber_db", JSON.stringify(db));
            alert("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!");
            go(3);
            loadHistDaily();
        }
    }

    function loadHistDaily() {
        const d = document.getElementById("histDate").value;
        const found = archives.find(a => a.date === d);
        const area = document.getElementById("histDailyArea");
        if(!found) { area.innerHTML = "<center style='color:#ccc; padding:20px;'>‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>"; return; }

        let rows = found.details.map(r => `
            <div class="history-row" style="font-size:13px;">
                <div style="display:flex; justify-content:space-between">
                    <b>${r.time} | ${r.svcs.join('+')}</b>
                    <b>‡∏ø${r.price}</b>
                </div>
                <div style="font-size:11px; opacity:0.6">${r.hair || ''} (${r.pay==='Cash'?'‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î':'‡πÇ‡∏≠‡∏ô'})</div>
            </div>
        `).join('');

        const settle = found.cash - found.barber;
        let settleText = settle > 0 ? `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ${settle}` : settle < 0 ? `Indigo ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡∏ä‡πà‡∏≤‡∏á: ${Math.abs(settle)}` : "üü¶ ‡∏û‡∏≠‡∏î‡∏µ";

        area.innerHTML = `
            <div style="background:var(--input-bg); padding:15px; border-radius:15px;">
                <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; font-size:14px;">
                    <div>‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: <b>${found.total}</b></div>
                    <div>‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤: <b>${found.count}</b></div>
                    <div>‡∏ä‡πà‡∏≤‡∏á‡πÑ‡∏î‡πâ: <b>${found.barber}</b></div>
                    <div>‡∏£‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ: <b>${found.shop}</b></div>
                </div>
                <div style="padding:10px; border-radius:10px; font-size:12px; text-align:center; margin-bottom:15px; background:rgba(0,0,0,0.05)">${settleText}</div>
                <label>‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£:</label>
                ${rows}
            </div>
        `;
    }

    function loadHistMonth() {
        const m = document.getElementById("histMonth").value;
        const area = document.getElementById("histMonthArea");
        if(!m) return;

        const filtered = archives.filter(a => a.date.startsWith(m));
        if(!filtered.length) { area.innerHTML = "<center style='color:#ccc'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</center>"; return; }

        let tot = 0, bTot = 0, hairs = {}, svcs = {};
        filtered.forEach(a => {
            tot += a.total; bTot += a.barber;
            a.details.forEach(r => {
                if(r.hair) hairs[r.hair] = (hairs[r.hair]||0)+1;
                r.svcs.forEach(s => svcs[s] = (svcs[s]||0)+1);
            });
        });

        const ranking = (obj) => Object.entries(obj).sort((a,b)=>b[1]-a[1]).slice(0,5).map(e=>`<span class="badge">${e[0]} (${e[1]})</span>`).join('');

        area.innerHTML = `
            <div style="padding:5px">
                <div style="font-size:18px;">‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡∏ß‡∏°: <b style="color:var(--primary)">‡∏ø${tot.toLocaleString()}</b></div>
                <div style="font-size:13px; opacity:0.8; margin-top:5px;">‡∏ä‡πà‡∏≤‡∏á: ‡∏ø${bTot.toLocaleString()} | ‡∏£‡πâ‡∏≤‡∏ô: ‡∏ø${(tot-bTot).toLocaleString()}</div>
                <div style="margin-top:20px;"><label>üèÜ Top Services:</label>${ranking(svcs)}</div>
                <div style="margin-top:10px;"><label>üèÜ Top Haircuts:</label>${ranking(hairs)}</div>
            </div>
        `;
    }
function shareLine() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    if (!today.length) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

    let tot = 0, cash = 0, shave = 0, wash = 0, dye = 0;
    today.sort((a, b) => a.id - b.id).forEach(r => {
        tot += r.price;
        if (r.pay === 'Cash') cash += r.price;
        r.svcs.forEach(s => {
            if (s === "‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î") shave++;
            if (s === "‡∏™‡∏£‡∏∞‡∏ú‡∏°") wash++;
            if (s === "‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°") dye++;
        });
    });

    const bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
    const sEarn = tot - bEarn;
    const settle = cash - bEarn;

    let msg = `üíà ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏£‡πâ‡∏≤‡∏ô: ${conf.shop}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${d}\n--------------------------\n`;
    msg += `üìù ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ (‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${today.length} ‡∏Ñ‡∏ô):\n`;
    today.forEach((r, i) => {
        msg += `${i + 1}. [${r.time}] ${r.svcs.join('+')}${r.hair ? '(' + r.hair + ')' : ''} = ${r.price} ${r.pay === 'Cash' ? 'üíµ' : 'üì±'}\n`;
    });
    msg += `--------------------------\nüìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô:\nü™í ‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î: ${shave} ‡∏Ñ‡∏ô\nüöø ‡∏™‡∏£‡∏∞‡∏ú‡∏°: ${wash} ‡∏Ñ‡∏ô\nüé® ‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°: ${dye} ‡∏Ñ‡∏ô\n--------------------------\n`;
    msg += `üí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${tot.toLocaleString()} ‡∏ö.\nü§µ ‡∏ä‡πà‡∏≤‡∏á: ${bEarn.toLocaleString()} ‡∏ö.\nüè† ‡∏£‡πâ‡∏≤‡∏ô: ${sEarn.toLocaleString()} ‡∏ö.\n`;
    
    let setMsg = tot === 0 ? "‡∏¢‡∏≠‡∏î‡∏û‡∏≠‡∏î‡∏µ" : settle > 0 ? `‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡πÉ‡∏´‡πâ‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${settle.toLocaleString()}` : settle < 0 ? `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.abs(settle).toLocaleString()}` : "‡∏¢‡∏≠‡∏î‡∏•‡∏á‡∏ï‡∏±‡∏ß‡∏û‡∏≠‡∏î‡∏µ";
    msg += `‚ö†Ô∏è ${setMsg}`;

    window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}

    function openSettings() { document.getElementById("modalSet").style.display = "flex"; document.getElementById("setShop").value = conf.shop; document.getElementById("setPerc").value = conf.perc; document.getElementById("setGuar").value = conf.guar; document.getElementById("setTheme").value = conf.theme; }
    function closeSettings() { document.getElementById("modalSet").style.display = "none"; }
    function setBg(c) { conf.bg = c; applySettings(); }
    function changeTheme(v) { conf.theme = v; applySettings(); }
    function saveSettings() { conf.shop = document.getElementById("setShop").value; conf.perc = Number(document.getElementById("setPerc").value); conf.guar = Number(document.getElementById("setGuar").value); conf.theme = document.getElementById("setTheme").value; localStorage.setItem("barber_conf", JSON.stringify(conf)); applySettings(); closeSettings(); }
    function applySettings() { document.getElementById("shopNameDisp").innerText = conf.shop; document.getElementById("mainBody").className = "theme-" + conf.theme; document.getElementById("mainBody").style.backgroundColor = conf.bg; }
    function clearAllData() { if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>








