<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Barber Note">
    <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
    <title>Barber Note Pro V6.3</title>

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap" rel="stylesheet">

    <style>
        :root { --primary: #2b459a; --bg: #f8fafc; --card: #ffffff; --text: #334155; --sub: #94a3b8; --border: #e2e8f0; --accent: #ef4444; --dark-blue: #1e293b; }
        
        /* Themes */
        .theme-blue { --primary: #2b459a; }
        .theme-dark { --primary: #6366f1; --bg: #0f172a; --card: #1e293b; --text: #f8fafc; --border: #334155; }
        .theme-green { --primary: #166534; }

        /* Backgrounds */
        .bg-white { --bg: #ffffff; } .bg-blue { --bg: #eff6ff; } .bg-green { --bg: #f0fdf4; }
        .bg-yellow { --bg: #fefce8; } .bg-pink { --bg: #fdf2f8; } .bg-purple { --bg: #faf5ff; } .bg-gray { --bg: #f1f5f9; }

        * { box-sizing: border-box; font-family: 'Kanit', sans-serif; -webkit-tap-highlight-color: transparent; }
        body { margin: 0; background: var(--bg); color: var(--text); padding-bottom: 80px; transition: 0.3s; }
        .page { display: none; padding: 15px; max-width: 500px; margin: auto; }
        .page.active { display: block; }

        .card { background: var(--card); border: 1px solid var(--border); border-radius: 20px; padding: 15px; margin-bottom: 12px; }
        .label { font-size: 11px; color: var(--sub); margin-bottom: 4px; font-weight: 600; text-transform: uppercase; }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--border); background: var(--card); color: var(--text); font-size: 16px; outline: none; }
        .btn { width: 100%; background: var(--primary); color: #fff; border: none; padding: 16px; border-radius: 16px; font-size: 16px; font-weight: 600; cursor: pointer; }
        
        /* Report Styled (Image 2 & 3) */
        .summary-box { background: #1e2533; color: white; border-radius: 24px; padding: 25px; text-align: center; }
        .summary-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; border-top: 1px solid rgba(255,255,255,0.1); padding-top: 20px; }
        .stat-card-row { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-top: 15px; }
        .stat-item { background: rgba(255,255,255,0.05); padding: 10px; border-radius: 12px; text-align: center; }

        .nav { position: fixed; bottom: 0; width: 100%; height: 75px; display: flex; background: var(--card); border-top: 1px solid var(--border); z-index: 1000; }
        .nav-item { flex: 1; text-align: center; display: flex; flex-direction: column; justify-content: center; font-size: 11px; color: var(--sub); text-decoration: none; }
        .nav-item.active { color: var(--primary); font-weight: 600; }

        #settingSection.open { display: block; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 2000; padding: 15px; overflow-y: auto; }
        #settingSection { display: none; }
        .screenshot-mode .nav, .screenshot-mode .btn-hide { display: none !important; }
        .trash-btn { color: #fecaca; cursor: pointer; padding: 5px; }
    </style>
</head>
<body class="theme-blue bg-gray">

<div id="rec" class="page active">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <span id="shopNameRec" style="font-size:18px; font-weight:800; color:var(--primary);">BARBER SHOP</span>
        <i class="fas fa-cog" style="color:var(--sub); font-size: 18px; cursor: pointer;" onclick="toggleSettings(true)"></i>
    </div>

    <div id="settingSection">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
            <h3>‚öôÔ∏è ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
            <button onclick="toggleSettings(false)" style="border:none; background:none; font-size:24px;">&times;</button>
        </div>
        <div class="card">
            <div class="label">‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô / ‡∏™‡∏≤‡∏Ç‡∏≤</div>
            <input type="text" id="setShop">
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:10px;">
                <div><div class="label">‡∏Ñ‡∏≠‡∏°‡∏°‡∏¥‡∏ä‡∏ä‡∏±‡πà‡∏ô (%)</div><input type="number" id="setPer"></div>
                <div><div class="label">‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô (‡∏ø)</div><input type="number" id="setGua"></div>
            </div>
        </div>
        <div class="card">
            <div class="label">‡∏ò‡∏µ‡∏°‡∏´‡∏•‡∏±‡∏Å</div>
            <select id="setTheme" onchange="saveSettings()">
                <option value="theme-blue">Blue Classic</option>
                <option value="theme-dark">Dark Mode</option>
                <option value="theme-green">Deep Green</option>
            </select>
            <div class="label" style="margin-top:10px;">‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏û‡∏≤‡∏™‡πÄ‡∏ó‡∏•</div>
            <select id="setBg" onchange="saveSettings()">
                <option value="bg-white">Pure White</option>
                <option value="bg-gray">Soft Gray</option>
                <option value="bg-blue">Pastel Blue</option>
                <option value="bg-green">Pastel Green</option>
                <option value="bg-yellow">Pastel Yellow</option>
                <option value="bg-pink">Pastel Pink</option>
                <option value="bg-purple">Pastel Purple</option>
            </select>
        </div>
        <button class="btn" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡∏∞‡∏Å‡∏•‡∏±‡∏ö</button>
    </div>

    <div class="card">
        <div class="label">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</div>
        <input type="date" id="recDate">
    </div>
    
    <div id="svcList"></div>
    <div style="text-align:center; margin-bottom:15px;">
        <button onclick="addRow()" style="background:none; border:none; color:var(--primary); font-weight:600;"><i class="fas fa-plus-circle"></i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</button>
    </div>

    <div class="card">
        <div class="label">‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button id="btnCash" class="btn" style="background:#fff; border:2px solid var(--primary); color:var(--primary);" onclick="setPay('‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î')">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</button>
            <button id="btnTrans" class="btn" style="background:#fff; border:2px solid var(--primary); color:var(--primary);" onclick="setPay('‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô')">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</button>
        </div>
    </div>
    <button class="btn" onclick="saveRecord()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
</div>

<div id="rep" class="page">
    <div style="text-align: center; margin-bottom: 15px;">
        <button class="btn-hide" onclick="document.body.classList.toggle('screenshot-mode')" style="background:#64748b; color:white; border:none; padding:5px 15px; border-radius:20px; font-size:12px; margin-bottom:10px;">üì∏ ‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡πÅ‡∏Ñ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏à‡∏≠</button>
        <div style="font-size: 24px; font-weight: 800; color: #4338ca;" id="shopNameRep">BARBER SHOP</div>
        <div id="repDateThai" style="color:var(--sub); font-size:14px;"></div>
    </div>

    <div class="card" style="padding:0; overflow:hidden; border:none;">
        <div style="display: flex; gap:10px;">
            <div style="flex:1; background:#5e52a1; color:white; padding:20px; border-radius:20px;">
                <div class="label" style="color:rgba(255,255,255,0.7)">‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡∏ß‡∏°</div>
                <div style="font-size:32px; font-weight:700;">‡∏ø<span id="sumTotal">0</span></div>
                <div style="font-size:14px; margin-top:10px;">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤ <span id="custCount">0</span> ‡∏Ñ‡∏ô</div>
                <div style="font-size:11px; opacity:0.8;" id="dailyStatsExtra"></div>
            </div>
            <div style="flex:1; background:white; padding:15px; border:1px solid #e2e8f0; border-radius:20px; display:flex; flex-direction:column; justify-content:center; gap:8px;">
                <div style="display:flex; justify-content:space-between; font-size:14px;"><span>‡πÇ‡∏≠‡∏ô‡∏£‡∏ß‡∏°</span> <strong id="sumTrans">0</strong></div>
                <div style="display:flex; justify-content:space-between; font-size:14px;"><span>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á</span> <strong id="barberEarn">0</strong></div>
                <div style="display:flex; justify-content:space-between; font-size:14px;"><span>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏£‡πâ‡∏≤‡∏ô</span> <strong id="shopEarn">0</strong></div>
            </div>
        </div>
    </div>

    <div id="bannerAction" style="text-align:center; padding:12px; border-radius:12px; font-weight:700; margin-bottom:15px; font-size:18px;"></div>

    <div id="repList"></div>

    <div style="text-align:center; margin-top: 20px;">
        <button class="btn-hide" onclick="clearToday()" style="background:none; border:none; color:var(--accent); font-size:14px; font-weight:600;">‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>
</div>

<div id="his" class="page">
    <div class="card" style="text-align: center;">
        <div id="hisDateLabel" style="font-size: 16px; margin-bottom: 10px;">13 Jan BE 2569</div>
        <button class="btn" style="background:#f59e0b; padding:10px;" onclick="renderHistory('month')">üìä ‡∏î‡∏π‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏ó‡∏±‡πâ‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</button>
    </div>

    <div class="summary-box">
        <div class="label" style="color:rgba(255,255,255,0.6)">‡∏™‡∏£‡∏∏‡∏õ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</div>
        <div style="font-size: 22px; font-weight: 700;" id="mTitle">‡πÄ‡∏î‡∏∑‡∏≠‡∏ô 01/2569</div>
        
        <div class="summary-grid">
            <div>
                <div class="label" style="color:rgba(255,255,255,0.6)">‡∏£‡∏±‡∏ö‡∏£‡∏ß‡∏°</div>
                <div style="font-size:24px; color:#4ade80;">‡∏ø<span id="mTotal">0</span></div>
            </div>
            <div>
                <div class="label" style="color:rgba(255,255,255,0.6)">‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤</div>
                <div style="font-size:24px; color:#60a5fa;"><span id="mCust">0</span> ‡∏Ñ‡∏ô</div>
            </div>
            <div style="border-top: 1px dashed rgba(255,255,255,0.2); grid-column: span 2; padding-top:15px; display:flex; justify-content:space-around;">
                <div>
                    <div class="label" style="color:rgba(255,255,255,0.6)">‡∏ä‡πà‡∏≤‡∏á</div>
                    <div style="font-size:20px; color:#fbbf24;">‡∏ø<span id="mBarber">0</span></div>
                </div>
                <div>
                    <div class="label" style="color:rgba(255,255,255,0.6)">‡∏£‡πâ‡∏≤‡∏ô</div>
                    <div style="font-size:20px; color:#f87171;">‡∏ø<span id="mShop">0</span></div>
                </div>
            </div>
        </div>

        <div class="label" style="margin-top:20px; color:rgba(255,255,255,0.6)">‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£ (‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á)</div>
        <div class="stat-card-row" id="mServiceStats">
            </div>
    </div>

    <div style="margin-top:20px;">
        <div class="label">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏≠‡∏∑‡πà‡∏ô</div>
        <input type="date" id="hisDateSelect" onchange="renderHistory('day')">
    </div>
    
    <button class="btn" style="background:#f1f5f9; color:var(--text); margin-top:15px;" onclick="go('rep')">‚ùÆ ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</button>
</div>

<nav class="nav">
    <a href="#" class="nav-item active" onclick="go('rec')"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</a>
    <a href="#" class="nav-item" onclick="go('rep')"><i class="fas fa-file-invoice-dollar"></i>‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô</a>
    <a href="#" class="nav-item" onclick="go('his')"><i class="fas fa-history"></i>‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</a>
</nav>

<script>
    const SERVICE_LIST = ["‡∏ï‡∏±‡∏î‡∏ú‡∏°", "‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î", "‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤", "‡∏™‡∏£‡∏∞‡∏ú‡∏°", "‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°", "‡∏î‡∏±‡∏î‡∏ú‡∏°", "‡∏¢‡∏∑‡∏î‡∏ú‡∏°", "‡πÅ‡∏Å‡πâ‡∏ú‡∏°", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"];
    const HAIR_STYLE_LIST = ["‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á", "‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î", "‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô / ‡∏ó‡∏π‡∏ö‡∏•‡πá‡∏≠‡∏Ñ", "‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "‡∏ï‡∏≥‡∏£‡∏ß‡∏à / ‡∏ó‡∏´‡∏≤‡∏£", "‡∏ó‡∏£‡∏á‡∏≠‡πÄ‡∏°‡∏£‡∏¥‡∏Å‡∏±‡∏ô", "‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡πâ‡∏≤‡∏á", "‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à", "‡∏≠‡∏∑‡πà‡∏ô‡πÜ"];

    let db = JSON.parse(localStorage.getItem("bn_db") || "[]");
    let cfg = JSON.parse(localStorage.getItem("bn_cfg") || '{"shop":"BARBER SHOP","per":50,"gua":200,"theme":"theme-blue","bg":"bg-gray"}');
    let payType = "‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î";

    function init() {
        const today = new Date().toISOString().split('T')[0];
        document.getElementById('recDate').value = today;
        document.getElementById('hisDateSelect').value = today;
        applyCfg();
        if(document.getElementById('svcList').children.length === 0) addRow();
        updatePayUI();
    }

    function toggleSettings(open) { document.getElementById('settingSection').className = open ? 'open' : ''; }

    function applyCfg() {
        document.body.className = `${cfg.theme} ${cfg.bg}`;
        document.getElementById('shopNameRec').innerText = cfg.shop;
        document.getElementById('shopNameRep').innerText = cfg.shop;
        document.getElementById('setShop').value = cfg.shop;
        document.getElementById('setPer').value = cfg.per;
        document.getElementById('setGua').value = cfg.gua;
    }

    function saveSettings() {
        cfg = {
            shop: document.getElementById('setShop').value,
            per: parseInt(document.getElementById('setPer').value) || 0,
            gua: parseInt(document.getElementById('setGua').value) || 0,
            theme: document.getElementById('setTheme').value,
            bg: document.getElementById('setBg').value
        };
        localStorage.setItem("bn_cfg", JSON.stringify(cfg));
        applyCfg();
        toggleSettings(false);
    }

    function addRow() {
        const div = document.createElement('div');
        div.className = "card svc-row";
        div.innerHTML = `
            <div style="display:grid; grid-template-columns: 1fr 1fr 80px 30px; gap:8px; align-items:center;">
                <select class="svc-n">${SERVICE_LIST.map(s=>`<option value="${s}">${s}</option>`).join('')}</select>
                <select class="svc-s">${HAIR_STYLE_LIST.map(s=>`<option value="${s}">${s}</option>`).join('')}</select>
                <input type="number" class="svc-p" value="100">
                <i class="fas fa-trash-alt" onclick="this.closest('.card').remove()" style="color:#f87171"></i>
            </div>
        `;
        document.getElementById('svcList').appendChild(div);
    }

    function setPay(t) { payType = t; updatePayUI(); }
    function updatePayUI() {
        const activeStyle = { background: 'var(--primary)', color: '#fff' };
        const inactiveStyle = { background: '#fff', color: 'var(--primary)' };
        Object.assign(document.getElementById('btnCash').style, payType === '‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î' ? activeStyle : inactiveStyle);
        Object.assign(document.getElementById('btnTrans').style, payType === '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô' ? activeStyle : inactiveStyle);
    }

    function saveRecord() {
        const rows = document.querySelectorAll('.svc-row');
        let items = [], total = 0;
        rows.forEach(r => {
            const p = parseInt(r.querySelector('.svc-p').value) || 0;
            items.push({ n: r.querySelector('.svc-n').value, s: r.querySelector('.svc-s').value, p: p });
            total += p;
        });
        const rec = { id: Date.now(), date: document.getElementById('recDate').value, items, payType, total };
        db.push(rec);
        localStorage.setItem("bn_db", JSON.stringify(db));
        go('rep');
    }

    function getDailyStats(date) {
        const dayRecords = db.filter(r => r.date === date);
        const total = dayRecords.reduce((s, r) => s + r.total, 0);
        const trans = dayRecords.filter(r => r.payType === '‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô').reduce((s, r) => s + r.total, 0);
        
        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á (‡∏ï‡∏≤‡∏°‡∏™‡πÄ‡∏õ‡∏Å‡∏£‡∏π‡∏õ‡∏ó‡∏µ‡πà 1: ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ)
        let barber = total * (cfg.per / 100);
        if (dayRecords.length > 0 && barber < cfg.gua) {
            barber = cfg.gua;
        } else if (dayRecords.length === 0) {
            barber = cfg.gua; // ‡πÅ‡∏™‡∏î‡∏á‡∏¢‡∏≠‡∏î‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡πÅ‡∏°‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏•‡∏π‡∏Å‡∏Ñ‡πâ‡∏≤‡∏ï‡∏≤‡∏°‡∏£‡∏π‡∏õ 1
        }
        
        const shop = total - barber;
        
        // ‡∏ô‡∏±‡∏ö‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£‡πÄ‡∏â‡∏û‡∏≤‡∏∞ ‡πÇ‡∏Å‡∏ô, ‡∏™‡∏£‡∏∞, ‡∏¢‡πâ‡∏≠‡∏° (‡∏ï‡∏≤‡∏°‡∏™‡πÄ‡∏õ‡∏Å‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô)
        let counts = { "‡πÇ‡∏Å‡∏ô": 0, "‡∏™‡∏£‡∏∞": 0, "‡∏¢‡πâ‡∏≠‡∏°": 0 };
        dayRecords.forEach(r => {
            r.items.forEach(i => {
                if(i.n.includes("‡πÇ‡∏Å‡∏ô")) counts["‡πÇ‡∏Å‡∏ô"]++;
                if(i.n.includes("‡∏™‡∏£‡∏∞")) counts["‡∏™‡∏£‡∏∞"]++;
                if(i.n.includes("‡∏¢‡πâ‡∏≠‡∏°")) counts["‡∏¢‡πâ‡∏≠‡∏°"]++;
            });
        });

        return { total, trans, barber, shop, cust: dayRecords.length, records: dayRecords, counts };
    }

    function renderReport() {
        const date = document.getElementById('recDate').value;
        const stats = getDailyStats(date);
        const d = new Date(date);
        document.getElementById('repDateThai').innerText = `${d.getDate()} ‡∏°.‡∏Ñ. ${d.getFullYear() + 543}`;
        
        document.getElementById('sumTotal').innerText = stats.total;
        document.getElementById('sumTrans').innerText = stats.trans;
        document.getElementById('barberEarn').innerText = Math.floor(stats.barber);
        document.getElementById('shopEarn').innerText = Math.floor(stats.shop);
        document.getElementById('custCount').innerText = stats.cust;
        
        document.getElementById('dailyStatsExtra').innerText = `‡πÇ‡∏Å‡∏ô ${stats.counts["‡πÇ‡∏Å‡∏ô"]} | ‡∏™‡∏£‡∏∞ ${stats.counts["‡∏™‡∏£‡∏∞"]} | ‡∏¢‡πâ‡∏≠‡∏° ${stats.counts["‡∏¢‡πâ‡∏≠‡∏°"]}`;

        const diff = stats.trans - stats.barber;
        const banner = document.getElementById('bannerAction');
        if (stats.records.length === 0) {
            banner.innerText = `‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ ‡∏ø${cfg.gua}`;
            banner.style.color = "#1e293b"; banner.style.background = "#e0e7ff";
        } else {
            banner.innerText = diff > 0 ? `‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.abs(diff)}` : `‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.abs(diff)}`;
            banner.style.background = diff > 0 ? "#eff6ff" : "#fef2f2";
            banner.style.color = diff > 0 ? "#1e40af" : "#b91c1c";
        }

        document.getElementById('repList').innerHTML = stats.records.map(r => `
            <div class="card" style="display:flex; justify-content:space-between; align-items:center;">
                <div>
                    <div style="font-weight:600; font-size:16px;">${r.items.map(i=>`${i.n} ${i.s}`).join(' + ')}</div>
                    <div style="font-size:12px; color:var(--sub);"><i class="far fa-clock"></i> 00:00 | <span style="background:#f1f5f9; padding:2px 8px; border-radius:10px;">${r.payType}</span></div>
                </div>
                <div style="text-align:right">
                    <div style="color:#f59e0b; font-weight:700; font-size:18px;">‡∏ø${r.total}</div>
                    <i class="fas fa-trash-alt btn-hide" onclick="deleteRecord(${r.id})" style="color:#fecaca; font-size:12px;"></i>
                </div>
            </div>
        `).join('');
    }

    function renderHistory(mode) {
        const date = document.getElementById('hisDateSelect').value;
        const d = new Date(date);
        document.getElementById('hisDateLabel').innerText = `${d.getDate()} Jan BE ${d.getFullYear() + 543}`;
        
        const month = date.substring(0, 7);
        const mRecs = db.filter(r => r.date.startsWith(month));
        
        const mTotal = mRecs.reduce((s,r) => s+r.total, 0);
        const mCust = mRecs.length;
        
        // ‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ä‡πà‡∏≤‡∏á‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô (‡∏Ñ‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô)
        let mBarber = 0;
        const daysInMonth = new Set(mRecs.map(r => r.date));
        daysInMonth.forEach(day => {
            mBarber += getDailyStats(day).barber;
        });

        document.getElementById('mTitle').innerText = `‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${month.split('-')[1]}/${d.getFullYear()+543}`;
        document.getElementById('mTotal').innerText = mTotal.toLocaleString();
        document.getElementById('mCust').innerText = mCust;
        document.getElementById('mBarber').innerText = Math.floor(mBarber).toLocaleString();
        document.getElementById('mShop').innerText = Math.floor(mTotal - mBarber).toLocaleString();

        // ‡∏ô‡∏±‡∏ö‡∏ó‡∏∏‡∏Å‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó (‡∏ï‡∏≤‡∏°‡∏™‡πÄ‡∏õ‡∏Å‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô)
        let sCounts = {};
        SERVICE_LIST.forEach(s => sCounts[s] = 0);
        mRecs.forEach(r => r.items.forEach(i => { if(sCounts[i.n] !== undefined) sCounts[i.n]++; }));

        document.getElementById('mServiceStats').innerHTML = SERVICE_LIST.slice(0, 3).map(s => `
            <div class="stat-item">
                <div class="label" style="font-size:10px;">${s}</div>
                <div style="font-size:18px; font-weight:700;">${sCounts[s]}</div>
            </div>
        `).join('');
    }

    function go(p) {
        document.querySelectorAll('.page').forEach(x => x.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(x => x.classList.remove('active'));
        document.getElementById(p).classList.add('active');
        const navIdx = p === 'rec' ? 0 : (p === 'rep' ? 1 : 2);
        document.querySelectorAll('.nav-item')[navIdx].classList.add('active');
        if(p === 'rep') renderReport();
        if(p === 'his') renderHistory('day');
    }

    function deleteRecord(id) {
        if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ?")) {
            db = db.filter(r => r.id !== id);
            localStorage.setItem("bn_db", JSON.stringify(db));
            renderReport();
        }
    }

    function clearToday() {
        if(confirm("‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î?")) {
            const today = document.getElementById('recDate').value;
            db = db.filter(r => r.date !== today);
            localStorage.setItem("bn_db", JSON.stringify(db));
            renderReport();
        }
    }

    window.onload = init;
</script>
</body>
</html>
