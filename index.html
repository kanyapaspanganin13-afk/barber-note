<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BARBER JOURNAL</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;600&display=swap');
        *{font-family:'Kanit',sans-serif;-webkit-tap-highlight-color:transparent;box-sizing:border-box}
        html,body{height:100vh;margin:0;overflow:hidden;background:#f8fafc}
        body{display:flex;flex-direction:column}
        header{background:#1e293b;color:white;padding:15px 0;text-align:center;flex-shrink:0}
        main{flex:1;overflow-y:auto;padding:10px;display:flex;flex-direction:column;gap:8px}
        
        /* ปรับช่องให้พอดีจอตามรูปที่ 3 */
        .card{background:white;border-radius:12px;border:1px solid #e2e8f0;padding:10px 15px;margin-bottom:2px;box-shadow:0 2px 4px rgba(0,0,0,0.02);flex-shrink:0}
        label{font-size:11px!important;color:#94a3b8;display:block;margin-bottom:-2px;font-weight:600}
        input,select{width:100%;font-size:18px!important;font-weight:600;color:#1e293b;border:none;background:transparent;outline:none;padding:2px 0}
        
        .pay-btn{border-radius:12px;padding:10px;text-align:center;border:2px solid #e2e8f0;background:white;flex:1;font-weight:600}
        .pay-btn.active{background:#1e293b;color:white;border-color:#1e293b}
        #btn-save{background:#1e293b;color:white;width:100%;padding:15px;border-radius:15px;font-size:20px!important;font-weight:700;margin-top:5px;flex-shrink:0}
        
        /* สไตล์หน้าประวัติรายวัน */
        .date-group{font-weight:bold;color:#64748b;margin-top:10px;margin-bottom:5px;font-size:14px;border-left:4px solid #1e293b;padding-left:8px}
        .history-card{background:white;border-radius:10px;padding:10px;display:flex;align-items:center;border-left:6px solid #e2e8f0;margin-bottom:5px;box-shadow:0 1px 3px rgba(0,0,0,0.05)}
        .nav-bar{height:75px;background:white;border-top:1px solid #e2e8f0;display:flex;flex-shrink:0}
        .nav-item{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;color:#94a3b8;font-size:12px}
        .nav-item.active{color:#1e293b;font-weight:700;border-top:3px solid #1e293b}
        .hidden{display:none!important}
    </style>
</head>
<body>
    <header id="main-header"><div class="text-2xl font-bold tracking-widest uppercase">BARBER JOURNAL</div></header>
    
    <main id="content">
        <div id="page-rec" class="flex flex-col h-full">
            <div class="card"><label>วันที่</label><input type="date" id="work-date"></div>
            <div class="flex gap-2">
                <div class="card flex-1"><label>เริ่ม</label><input type="time" id="t-start"></div>
                <div class="card flex-1"><label>เสร็จ</label><input type="time" id="t-end"></div>
            </div>
            
            <div id="svc-list" class="overflow-y-auto" style="max-height: 180px;">
                <div class="card border-l-4 border-blue-500 flex svc-row relative">
                    <div class="flex-1"><label>บริการ</label>
                        <select class="svc-name">
                            <option>ตัดผม</option><option>ย้อมผม</option><option>สระผม</option>
                            <option>โกนหนวด</option><option>อื่นๆ</option>
                        </select>
                    </div>
                    <div class="w-24 text-right border-l pl-2"><label>ราคา</label>
                        <input type="number" class="svc-price text-blue-600 text-right" placeholder="0">
                    </div>
                </div>
            </div>
            
            <button onclick="addSvc()" class="w-full border-2 border-dashed py-2 rounded-xl text-gray-400 font-bold text-xs mb-1">+ เพิ่มบริการ</button>

            <div class="card"><label>ทรงผม</label>
                <select id="h-style">
                    <option>รองทรง</option><option>วินเทจ</option><option>นักเรียน</option><option>แฟชั่น</option>
                </select>
            </div>
            
            <div class="flex gap-2">
                <div onclick="setPay('cash')" id="p-cash" class="pay-btn active">เงินสด</div>
                <div onclick="setPay('transfer')" id="p-trans" class="pay-btn">โอนเงิน</div>
            </div>
            
            <button id="btn-save" onclick="saveLocal()">บันทึกลงเครื่อง</button>
        </div>

        <div id="page-rep" class="hidden h-full flex flex-col">
            <div id="hist-list" class="flex-1 overflow-y-auto"></div>
            <div class="p-2 border-t mt-auto text-center">
                <button onclick="clearAll()" class="text-red-400 text-xs underline">ล้างประวัติทั้งหมด</button>
            </div>
        </div>
    </main>

    <nav class="nav-bar">
        <div onclick="nav('rec')" id="n-rec" class="nav-item active"><i class="fa-solid fa-edit text-xl"></i>บันทึก</div>
        <div onclick="nav('rep')" id="n-rep" class="nav-item"><i class="fa-solid fa-book text-xl"></i>ประวัติรายวัน</div>
    </nav>

    <script>
        let db=JSON.parse(localStorage.getItem('barber_local_db'))||[], payType='cash';
        const monthsThai=["ม.ค.","ก.พ.","มี.ค.","เม.ย.","พ.ค.","มิ.ย.","ก.ค.","ส.ค.","ก.ย.","ต.ค.","พ.ย.","ธ.ค."];

        function init(){
            const n=new Date();
            document.getElementById('work-date').valueAsDate=n;
            document.getElementById('t-start').value=n.toTimeString().slice(0,5);
            document.getElementById('t-end').value=new Date(n.getTime()+30*60000).toTimeString().slice(0,5);
        }

        function addSvc(){
            const div=document.createElement('div'); div.className="card border-l-4 border-blue-500 flex svc-row relative mt-1";
            div.innerHTML=document.querySelector('.svc-row').innerHTML+`<button onclick="this.parentElement.remove()" class="absolute -top-1 -right-1 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-[10px]">✕</button>`;
            document.getElementById('svc-list').appendChild(div);
        }

        function setPay(t){
            payType=t;
            document.getElementById('p-cash').className=t=='cash'?'pay-btn active':'pay-btn';
            document.getElementById('p-trans').className=t=='transfer'?'pay-btn active':'pay-btn';
        }

        function saveLocal(){
            let total=0, svcs=[];
            document.querySelectorAll('.svc-row').forEach(r=>{
                const p=Number(r.querySelector('.svc-price').value);
                if(p){total+=p;svcs.push(r.querySelector('.svc-name').value)}
            });
            if(!total) return alert("กรุณาใส่ราคา");

            const rec={
                id:Date.now(),
                date:document.getElementById('work-date').value,
                services:svcs.join(','),
                hairstyle:document.getElementById('h-style').value,
                total:total,
                t_start:document.getElementById('t-start').value,
                t_end:document.getElementById('t-end').value,
                payment:payType=='cash'?'เงินสด':'โอนเงิน'
            };
            db.push(rec);
            localStorage.setItem('barber_local_db',JSON.stringify(db));
            alert("บันทึกในเครื่องสำเร็จ");
            location.reload();
        }

        function nav(p){
            document.getElementById('page-rec').classList.toggle('hidden',p!='rec');
            document.getElementById('page-rep').classList.toggle('hidden',p!='rep');
            document.getElementById('n-rec').classList.toggle('active',p=='rec');
            document.getElementById('n-rep').classList.toggle('active',p=='rep');
            if(p=='rep') renderHistory();
        }

        function renderHistory(){
            const list=document.getElementById('hist-list'); list.innerHTML='';
            const groups=db.reduce((acc,item)=>{
                if(!acc[item.date]) acc[item.date]=[];
                acc[item.date].push(item); return acc;
            },{});

            Object.keys(groups).sort().reverse().forEach(date=>{
                const d=new Date(date);
                const dateTitle=`${d.getDate()} ${monthsThai[d.getMonth()]} ${d.getFullYear()+543}`;
                let dayTotal=0;
                let dayHTML=`<div class="date-group">${dateTitle}</div>`;
                
                groups[date].slice().reverse().forEach(r=>{
                    dayTotal+=r.total;
                    dayHTML+=`<div class="history-card">
                        <div class="flex-1">
                            <div class="font-bold text-sm">${r.services}</div>
                            <div class="text-[10px] text-gray-400">${r.t_start}-${r.t_end} | ${r.hairstyle}</div>
                        </div>
                        <div class="text-right">
                            <div class="font-bold">฿${r.total}</div>
                            <div class="text-[9px] text-blue-500 font-bold">${r.payment}</div>
                        </div>
                        <button onclick="delItem(${r.id})" class="ml-3 text-gray-300"><i class="fa-solid fa-trash text-xs"></i></button>
                    </div>`;
                });
                list.innerHTML+=`<div class="mb-4 text-right pr-2 text-xs text-gray-500">ยอดรวมวันนนี้: <b>฿${dayTotal}</b></div>`+dayHTML;
            });
        }

        function delItem(id){ if(confirm('ลบรายการนี้?')){db=db.filter(i=>i.id!=id);localStorage.setItem('barber_local_db',JSON.stringify(db));renderHistory();}}
        function clearAll(){ if(confirm('ลบประวัติทั้งหมดในเครื่อง?')){localStorage.removeItem('barber_local_db');db=[];renderHistory();}}
        window.onload=init;
    </script>
</body>
</html>
