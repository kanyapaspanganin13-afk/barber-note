<!DOCTYPE html>
<html lang="th">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
Â  Â  <meta name="apple-mobile-web-app-capable" content="yes">
Â  Â  <link rel="apple-touch-icon" href="https://i.ibb.co/27GqTXFn/Barber-Note.png">
Â  Â  <title>Barber Note v3.4 Final Draft</title>
Â  Â  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
Â  Â  <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
Â  Â  <style>
Â  Â  Â  Â  :root {
Â  Â  Â  Â  Â  Â  --primary: #1e3a8a; --accent: #16a34a; --danger: #dc2626; --warning: #f59e0b;
Â  Â  Â  Â  Â  Â  --main-bg: #f1f5f9; --card: #ffffff; --text: #1e293b; --input-bg: #f8fafc;
Â  Â  Â  Â  Â  Â  --indigo: #818cf8;
Â  Â  Â  Â  }
Â  Â  Â  Â  body.theme-dark { --main-bg: #0f172a; --card: #1e293b; --text: #f8fafc; --input-bg: #334155; }
Â  Â  Â  Â  body.theme-pastel { --main-bg: #faf5ff; --card: #ffffff; --text: #4c1d95; --input-bg: #f5f3ff; }

Â  Â  Â  Â  body { margin: 0; font-family: 'Kanit', sans-serif; background: var(--main-bg); color: var(--text); padding-bottom: 90px; transition: 0.3s; font-weight: 300; }
Â  Â  Â  Â  header { padding: 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
Â  Â  Â  Â  header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .page { display: none; padding: 15px; animation: fadeIn 0.2s; }
Â  Â  Â  Â  .page.active { display: block; }
Â  Â  Â  Â  @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

Â  Â  Â  Â  .card { background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
Â  Â  Â  Â  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  label { font-size: 13px; font-weight: 500; opacity: 0.8; margin-bottom: 5px; display: block; }
Â  Â  Â  Â  input, select { width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 16px; box-sizing: border-box; background: var(--input-bg); color: var(--text); outline: none; font-family: 'Kanit'; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .time-input { text-align: center; font-weight: 500; letter-spacing: 1px; }
Â  Â  Â  Â  .btn-pay { border: 2px solid transparent; background: var(--input-bg); color: var(--text); padding: 12px; border-radius: 12px; font-weight: 500; cursor: pointer; transition: 0.2s; }
Â  Â  Â  Â  .btn-pay.active-cash { border-color: var(--warning); color: var(--warning); background: #fffbeb; }
Â  Â  Â  Â  .btn-pay.active-transfer { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
Â  Â  Â  Â Â 
Â  Â  Â  Â  .status-bar { width: 100%; padding: 15px; border-radius: 15px; text-align: center; font-weight: 600; font-size: 16px; margin: 10px 0; box-sizing: border-box; }
Â  Â  Â  Â  .status-red { background: #fee2e2; color: #dc2626; }
Â  Â  Â  Â  .status-green { background: #dcfce7; color: #16a34a; }
Â  Â  Â  Â  .status-blue { background: #e0f2fe; color: #0284c7; }
Â  Â  Â  Â  .status-indigo { background: #e0e7ff; color: #4338ca; }

Â  Â  Â  Â  .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid rgba(0,0,0,0.05); padding-bottom: env(safe-area-inset-bottom); z-index: 100; }
Â  Â  Â  Â  .nav-item { flex: 1; text-align: center; padding: 12px; color: #94a3b8; font-size: 12px; cursor: pointer; }
Â  Â  Â  Â  .nav-item.active { color: var(--primary); font-weight: 600; }
Â  Â  Â  Â  .nav-item i { font-size: 20px; display: block; margin-bottom: 4px; }

Â  Â  Â  Â  .btn-save { background: var(--primary); color: white; width: 100%; padding: 16px; border-radius: 16px; font-size: 18px; font-weight: 600; border: none; margin-top: 10px; cursor: pointer; }
Â  Â  Â  Â  .btn-close-day { position: fixed; bottom: 85px; right: 20px; width: 60px; height: 60px; border-radius: 30px; background: #818cf8; color: white; border: none; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 99; font-size: 24px; cursor: pointer; }

Â  Â  Â  Â  .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.6); display: none; align-items: center; justify-content: center; z-index: 1000; padding: 20px; }
Â  Â  Â  Â  .modal-content { background: var(--card); width: 100%; border-radius: 25px; padding: 22px; max-height: 85vh; overflow-y: auto; }
Â  Â  Â  Â  .badge { background: rgba(0,0,0,0.05); padding: 4px 10px; border-radius: 8px; font-size: 12px; margin: 2px; display: inline-block; color: var(--primary); font-weight: 500; }
Â  Â  Â  Â  .history-row { padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.03); font-size: 14px; }

Â  Â  Â  Â  .color-dot { width: 30px; height: 30px; border-radius: 50%; cursor: pointer; border: 2px solid #ddd; display: inline-block; transition: 0.2s; }
Â  Â  Â  Â  .color-dot:hover { transform: scale(1.1); border-color: #999; }
Â  Â  </style>
</head>
<body id="mainBody">

<header>
Â  Â  <div style="width:40px"></div>
Â  Â  <h1 id="shopNameDisp">Barber Note</h1>
Â  Â  <div style="width:40px; text-align:right; cursor:pointer" onclick="openSettings()"><i class="fas fa-cog"></i></div>
</header>
Â  Â 
<div id="p1" class="page active">
Â  Â  <div class="card">
Â  Â  Â  Â  <div style="display: flex; align-items: center; gap: 10px; margin-bottom:15px;">
Â  Â  Â  Â  Â  Â  <i class="fas fa-calendar-day" style="color:var(--primary)"></i>
Â  Â  Â  Â  Â  Â  <input type="date" id="dateInp" style="padding: 5px; background:none;">
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="grid-2">
Â  Â  Â  Â  Â  Â  <div><label>à¹€à¸§à¸¥à¸²à¹€à¸£à¸´à¹ˆà¸¡</label><input type="tel" id="tStart" placeholder="0900" class="time-input" maxlength="4"></div>
Â  Â  Â  Â  Â  Â  <div><label>à¹€à¸§à¸¥à¸²à¹€à¸ªà¸£à¹‡à¸ˆ</label><input type="tel" id="tEnd" placeholder="0930" class="time-input" maxlength="4"></div>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â <div class="card">
Â  Â  <label>à¸•à¸±à¸”à¸œà¸¡ & à¸—à¸£à¸‡à¸œà¸¡</label>
Â  Â  <div class="grid-2" style="margin-bottom:10px">
Â  Â  Â  Â  <select id="mainSvc">
Â  Â  Â  Â  Â  Â  <option value="">(à¹„à¸¡à¹ˆà¹€à¸¥à¸·à¸­à¸)</option>
Â  Â  Â  Â  Â  Â  <option value="à¹€à¸”à¹‡à¸" selected>à¹€à¸”à¹‡à¸</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <select id="hairStyle">
Â  Â  Â  Â  Â  Â  <option value="">(à¹„à¸¡à¹ˆà¹€à¸¥à¸·à¸­à¸)</option>
Â  Â  Â  Â  Â  Â  <option>à¸£à¸­à¸‡à¸—à¸£à¸‡</option>
Â  Â  Â  Â  Â  Â  <option>à¹à¸Ÿà¸Šà¸±à¹ˆà¸™</option>
Â  Â  Â  Â  Â  Â  <option>à¸ªà¸à¸´à¸™à¹€à¸Ÿà¸”</option>
Â  Â  Â  Â  Â  Â  <option>à¹€à¸›à¸´à¸”à¸‚à¹‰à¸²à¸‡</option>
Â  Â  Â  Â  Â  Â  <option>à¸§à¸´à¸™à¹€à¸—à¸ˆ</option>
Â  Â  Â  Â  Â  Â  <option>à¸•à¸³à¸£à¸§à¸ˆ/à¸—à¸«à¸²à¸£</option>
Â  Â  Â  Â  Â  Â  <option>à¸—à¸£à¸‡à¸™à¸±à¸à¹€à¸£à¸µà¸¢à¸™</option>
Â  Â  Â  Â  Â  Â  <option>à¸­à¸·à¹ˆà¸™à¹†</option>
Â  Â  Â  Â  </select>
Â  Â  </div>
</div>
Â  Â  <div class="card">
Â  Â  Â  Â  <label>à¸„à¹ˆà¸²à¸šà¸£à¸´à¸à¸²à¸£</label>
Â  Â  Â  Â  <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:40px; font-weight:600; color:var(--primary); text-align:center; background:var(--input-bg); height:80px;">
Â  Â  Â  Â  <div class="grid-2" style="margin-top:15px">
Â  Â  Â  Â  Â  Â  <button id="btnCash" class="btn-pay" onclick="selectPay('Cash')">ğŸ’µ à¹€à¸‡à¸´à¸™à¸ªà¸”</button>
Â  Â  Â  Â  Â  Â  <button id="btnTrans" class="btn-pay" onclick="selectPay('Trans')">ğŸ“± à¹‚à¸­à¸™à¹€à¸‡à¸´à¸™</button>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <button class="btn-save" id="mainSaveBtn" onclick="handleSave()">à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥</button>
</div>

<div id="p2" class="page">
Â  Â  <div class="grid-2">
Â  Â  Â  Â  <div class="card" style="text-align: center;">
Â  Â  Â  Â  Â  Â  <label>à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™à¸£à¸§à¸¡à¸§à¸±à¸™à¸™à¸µà¹‰</label>
Â  Â  Â  Â  Â  Â  <div id="dTotal" style="font-size:28px; font-weight:600">0</div>
Â  Â  Â  Â  Â  Â  <div id="dCounts" style="font-size:12px; opacity:0.6;">à¸¥à¸¹à¸à¸„à¹‰à¸²: 0 à¸„à¸™</div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card">
Â  Â  Â  Â  Â  Â  <div style="font-size:13px; margin-bottom:4px;">ğŸ“± à¹‚à¸­à¸™: <b id="dTrans">0</b></div>
Â  Â  Â  Â  Â  Â  <div style="font-size:13px; margin-bottom:4px;">ğŸ¤µ à¸Šà¹ˆà¸²à¸‡: <b id="dBarber">0</b></div>
Â  Â  Â  Â  Â  Â  <div style="font-size:13px;">ğŸ  à¸£à¹‰à¸²à¸™: <b id="dShop">0</b></div>
Â  Â  Â  Â  </div>
Â  Â  </div>
Â  Â  <div id="settleBar" class="status-bar status-blue">à¸¢à¸­à¸”à¸à¸­à¸”à¸µ</div>
Â  Â  <div class="card">
Â  Â  Â  Â  <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:12px;">
Â  Â  Â  Â  Â  Â  <label>à¸£à¸²à¸¢à¸à¸²à¸£à¸§à¸±à¸™à¸™à¸µà¹‰</label>
Â  Â  Â  Â  Â  Â  <i class="fab fa-line" style="color:#06C755; font-size:24px;" onclick="shareLine()"></i>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div id="dServiceStats" style="margin-bottom:15px;"></div>
Â  Â  Â  Â  <div id="dailyList"></div>
Â  Â  </div>
Â  Â  <button class="btn-close-day" onclick="closeDay()"><i class="fas fa-check-circle"></i></button>
</div>

<div id="p3" class="page">
Â  Â  <div class="card" style="border-top: 4px solid var(--primary);">
Â  Â  Â  Â  <label>à¹€à¸£à¸µà¸¢à¸à¸”à¸¹à¸›à¸£à¸°à¸§à¸±à¸•à¸´à¸£à¸²à¸¢à¸§à¸±à¸™</label>
Â  Â  Â  Â  <input type="date" id="histDate" onchange="loadHistDaily()">
Â  Â  Â  Â  <div id="histDailyArea" style="margin-top:15px"></div>
Â  Â  </div>
Â  Â  <div class="card" style="border-top: 4px solid var(--warning);">
Â  Â  Â  Â  <label>à¸ªà¸£à¸¸à¸›à¸ªà¸–à¸´à¸•à¸´à¸£à¸²à¸¢à¹€à¸”à¸·à¸­à¸™</label>
Â  Â  Â  Â  <input type="month" id="histMonth" onchange="loadHistMonth()">
Â  Â  Â  Â  <div id="histMonthArea" style="margin-top:15px"></div>
Â  Â  </div>
</div>

<div id="modalSet" class="modal">
Â  Â  <div class="modal-content">
Â  Â  Â  Â  <h3>âš™ï¸ à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²à¸£à¸°à¸šà¸š</h3>
Â  Â  Â  Â  <label>à¸Šà¸·à¹ˆà¸­à¸£à¹‰à¸²à¸™</label><input id="setShop">
Â  Â  Â  Â  <div class="grid-2" style="margin-top:10px">
Â  Â  Â  Â  Â  Â  <div><label>% à¸„à¸­à¸¡à¸¡à¸´à¸Šà¸Šà¸±à¹ˆà¸™</label><input type="number" id="setPerc"></div>
Â  Â  Â  Â  Â  Â  <div><label>à¸›à¸£à¸°à¸à¸±à¸™à¸£à¸²à¸¢à¸§à¸±à¸™</label><input type="number" id="setGuar"></div>
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <label style="margin-top:15px">à¹‚à¸«à¸¡à¸”à¸ªà¸µ</label>
Â  Â  Â  Â  <select id="setTheme" onchange="changeTheme(this.value)">
Â  Â  Â  Â  Â  Â  <option value="light">Light Mode</option>
Â  Â  Â  Â  Â  Â  <option value="dark">Dark Mode</option>
Â  Â  Â  Â  Â  Â  <option value="pastel">Pastel Mode</option>
Â  Â  Â  Â  </select>
Â  Â  Â  Â  <label style="margin-top:15px">à¸ªà¸µà¸à¸·à¹‰à¸™à¸«à¸¥à¸±à¸‡</label>
Â  Â  Â  Â  <div id="colorPicker" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 5px;">
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#fdf2f8" onclick="setBg('#fdf2f8')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#f0fdf4" onclick="setBg('#f0fdf4')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#f0f9ff" onclick="setBg('#f0f9ff')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#fffbeb" onclick="setBg('#fffbeb')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#f1f5f9" onclick="setBg('#f1f5f9')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#eef2ff" onclick="setBg('#eef2ff')"></div>
Â  Â  Â  Â  Â  Â  <div class="color-dot" style="background:#fff7ed" onclick="setBg('#fff7ed')"></div>
Â  Â  Â  Â </div>
Â  Â  <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px;">
Â  Â  Â  Â  <button class="btn-save" onclick="saveSettings()" style="width:100%; margin:0;">à¸šà¸±à¸™à¸—à¸¶à¸à¸à¸²à¸£à¸•à¸±à¹‰à¸‡à¸„à¹ˆà¸²</button>
Â  Â  Â  Â  <button onclick="closeSettings()" style="width:100%; margin:0; border: 1px solid var(--border); background: #f8fafc; color: #666; border-radius: 10px; cursor: pointer; font-weight: 500;">à¸›à¸´à¸”à¸«à¸™à¹‰à¸²à¸•à¹ˆà¸²à¸‡</button>
Â  Â  </div>
</div>

<nav class="nav">
Â  Â  <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>à¸šà¸±à¸™à¸—à¸¶à¸</div>
Â  Â  <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-calendar-check"></i>à¸£à¸²à¸¢à¸§à¸±à¸™</div>
Â  Â  <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i>à¸ªà¸–à¸´à¸•à¸´</div>
</nav>

<script>
Â  Â  let payMethod = "";
Â  Â  let conf = JSON.parse(localStorage.getItem("barber_conf")) || {shop:"Barber Shop", perc:50, guar:0, theme:"light", bg:"#f1f5f9"};
Â  Â  let db = JSON.parse(localStorage.getItem("barber_db")) || [];Â 
Â  Â  let archives = JSON.parse(localStorage.getItem("barber_arc")) || [];Â 

Â  Â  window.onload = () => {
Â  Â  Â  Â  document.getElementById("dateInp").valueAsDate = new Date();
Â  Â  Â  Â  applySettings();
Â  Â  };

Â  Â  document.querySelectorAll('.time-input').forEach(inp => {
Â  Â  Â  Â  inp.addEventListener('input', (e) => {
Â  Â  Â  Â  Â  Â  let v = e.target.value.replace(/\D/g, '');
Â  Â  Â  Â  Â  Â  if(v.length >= 4) {
Â  Â  Â  Â  Â  Â  Â  Â  e.target.value = v.substring(0,2) + ":" + v.substring(2,4);
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });
Â  Â  });

Â  Â  function go(n) {
Â  Â  Â  Â  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
Â  Â  Â  Â  document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
Â  Â  Â  Â  document.getElementById('p'+n).classList.add('active');
Â  Â  Â  Â  document.getElementById('n'+n).classList.add('active');
Â  Â  Â  Â  if(n===2) renderDay();
Â  Â  }

Â  Â  function selectPay(m) {
Â  Â  Â  Â  payMethod = m;
Â  Â  Â  Â  document.getElementById("btnCash").className = m==='Cash'?'btn-pay active-cash':'btn-pay';
Â  Â  Â  Â  document.getElementById("btnTrans").className = m==='Trans'?'btn-pay active-transfer':'btn-pay';
Â  Â  }

Â  Â  function handleSave() {
        const p = document.getElementById("priceInp").value;
        const mainSvcValue = document.getElementById("mainSvc").value; // à¸”à¸¶à¸‡à¸„à¹ˆà¸² "à¹€à¸”à¹‡à¸"
        if(!p || !payMethod) return alert("à¸£à¸°à¸šà¸¸à¸£à¸²à¸„à¸²à¹à¸¥à¸°à¸§à¸´à¸˜à¸µà¸Šà¸³à¸£à¸°à¹€à¸‡à¸´à¸™");

        const rec = {
            id: Date.now(),
            date: document.getElementById("dateInp").value,
            time: `${document.getElementById("tStart").value}-${document.getElementById("tEnd").value}`,
            mainSvc: mainSvcValue, 
            svcs: mainSvcValue ? [mainSvcValue] : [], 
            hair: document.getElementById("hairStyle").value,
            price: Number(p),
            pay: payMethod
        };

        db.push(rec);
        localStorage.setItem("barber_db", JSON.stringify(db));
        
        const b = document.getElementById("mainSaveBtn");
        b.innerText = "à¸šà¸±à¸™à¸—à¸¶à¸à¹à¸¥à¹‰à¸§ âœ“"; b.style.background = "var(--accent)";
        
        setTimeout(() => {
            b.innerText = "à¸šà¸±à¸™à¸—à¸¶à¸à¸‚à¹‰à¸­à¸¡à¸¹à¸¥"; b.style.background = "var(--primary)";
            document.getElementById("priceInp").value = "";
            document.getElementById("tStart").value = document.getElementById("tEnd").value;
            document.getElementById("tEnd").value = "";
            // à¸¥à¹‰à¸²à¸‡à¸„à¹ˆà¸²à¹€à¸¡à¸™à¸¹à¹€à¸¥à¸·à¸­à¸ (à¸–à¹‰à¸²à¸•à¹‰à¸­à¸‡à¸à¸²à¸£)
            document.getElementById("mainSvc").value = "à¹€à¸”à¹‡à¸";
            document.getElementById("hairStyle").value = "";
            selectPay("");
        }, 800);
    }

Â  Â function renderDay() {
    const d = document.getElementById("dateInp").value;
    const today = db.filter(r => r.date === d);
    let tot = 0, trans = 0, cash = 0, stats = {};
    let listHtml = "";
    
    today.sort((a,b) => b.id - a.id).forEach(r => {
        tot += r.price;
        if(r.pay==='Trans') trans += r.price; else cash += r.price;
        
        // à¸•à¸£à¸§à¸ˆà¸ªà¸­à¸šà¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¸‚à¸­à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥ r.svcs
        if(r.svcs) r.svcs.forEach(s => stats[s] = (stats[s]||0)+1);
        
        listHtml += `<div class="history-row">
            <div style="display:flex; justify-content:space-between; font-weight:500">
                <span>${r.time} | ${r.hair || ''}${r.mainSvc === 'à¹€à¸”à¹‡à¸' ? '(à¹€à¸”à¹‡à¸)' : ''}</span>
                <span>à¸¿${r.price}</span>
            </div>
            <div style="display:flex; justify-content:space-between; font-size:12px; opacity:0.7; margin-top:2px;">
                <span>${r.svcs ? r.svcs.join('+') : ''}</span>
                <span>${r.pay==='Cash'?'ğŸ’µ à¸ªà¸”':'ğŸ“± à¹‚à¸­à¸™'} <i class="fas fa-trash" style="margin-left:10px" onclick="delRec(${r.id})"></i></span>
            </div>
        </div>`;
    });
    
    // à¸­à¸±à¸›à¹€à¸”à¸•à¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥à¹ƒà¸™à¸«à¸™à¹‰à¸²à¹€à¸§à¹‡à¸š
    document.getElementById("dailyList").innerHTML = listHtml || "<center>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>";
    document.getElementById("dTotal").innerText = tot.toLocaleString();
    
    // à¸„à¸³à¸™à¸§à¸“à¸ªà¹ˆà¸§à¸™à¹à¸šà¹ˆà¸‡ (à¸•à¸±à¸§à¸­à¸¢à¹ˆà¸²à¸‡)
    const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
    document.getElementById("dBarber").innerText = Math.floor(bEarn).toLocaleString();
    document.getElementById("dShop").innerText = Math.floor(tot - bEarn).toLocaleString();
}
Â  Â  Â  Â  const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
Â  Â  Â  Â  const sEarn = tot - bEarn;
Â  Â  Â  Â  const settle = cash - bEarn;
Â  Â  Â  Â  document.getElementById("dTotal").innerText = tot.toLocaleString();
Â  Â  Â  Â  document.getElementById("dTrans").innerText = trans.toLocaleString();
Â  Â  Â  Â  document.getElementById("dBarber").innerText = bEarn.toLocaleString();
Â  Â  Â  Â  document.getElementById("dShop").innerText = sEarn.toLocaleString();
Â  Â  Â  Â  document.getElementById("dCounts").innerText = `à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸²: ${today.length} à¸„à¸™`;
Â  Â  Â  Â  document.getElementById("dailyList").innerHTML = listHtml || "<center style='padding:40px; opacity:0.3'>à¸¢à¸±à¸‡à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>";
Â  Â  Â  Â  let statHtml = "";
Â  Â  Â  Â  for(let s in stats) { statHtml += `<span class="badge">${s}: ${stats[s]}</span>`; }
Â  Â  Â  Â  document.getElementById("dServiceStats").innerHTML = statHtml;
Â  Â  Â  Â  const bar = document.getElementById("settleBar");
Â  Â  Â  Â  if(tot === 0) { bar.innerText = "ğŸŸ¦ à¸¢à¸­à¸”à¸à¸­à¸”à¸µ"; bar.className = "status-bar status-blue"; }
Â  Â  Â  Â  else if(settle > 0) { bar.innerText = `ğŸŸ¥ à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¸ªà¸”à¹ƒà¸«à¹‰à¸£à¹‰à¸²à¸™ à¸¿${settle.toLocaleString()}`; bar.className = "status-bar status-red"; }
Â  Â  Â  Â  else if(settle < 0) { bar.innerText = `à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¹ƒà¸«à¹‰à¸Šà¹ˆà¸²à¸‡ à¸¿${Math.abs(settle).toLocaleString()}`; bar.className = "status-bar status-indigo"; }
Â  Â  Â  Â  else { bar.innerText = "ğŸŸ¦ à¸¢à¸­à¸”à¸¥à¸‡à¸•à¸±à¸§à¸à¸­à¸”à¸µ"; bar.className = "status-bar status-blue"; }
Â  Â  }

Â  Â  function delRec(id) {
Â  Â  Â  Â  if(confirm("à¸¥à¸šà¸£à¸²à¸¢à¸à¸²à¸£à¸™à¸µà¹‰?")) {
Â  Â  Â  Â  Â  Â  db = db.filter(r => r.id !== id);
Â  Â  Â  Â  Â  Â  localStorage.setItem("barber_db", JSON.stringify(db));
Â  Â  Â  Â  Â  Â  renderDay();
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function closeDay() {
Â  Â  Â  Â  const d = document.getElementById("dateInp").value;
Â  Â  Â  Â  const today = db.filter(r => r.date === d);
Â  Â  Â  Â  if(!today.length) return alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥");
Â  Â  Â  Â  if(confirm("à¸›à¸´à¸”à¸¢à¸­à¸”à¸§à¸±à¸™à¸™à¸µà¹‰à¹à¸¥à¸°à¸ªà¹ˆà¸‡à¹„à¸›à¸«à¸™à¹‰à¸²à¸ªà¸–à¸´à¸•à¸´?")) {
Â  Â  Â  Â  Â  Â  const tot = today.reduce((a,b) => a+b.price, 0);
Â  Â  Â  Â  Â  Â  const bEarn = Math.max(tot * (conf.perc/100), conf.guar);
Â  Â  Â  Â  Â  Â  const arc = {
Â  Â  Â  Â  Â  Â  Â  Â  date: d, total: tot, barber: bEarn, shop: tot-bEarn, count: today.length, details: today,
Â  Â  Â  Â  Â  Â  Â  Â  cash: today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price, 0)
Â  Â  Â  Â  Â  Â  };
Â  Â  Â  Â  Â  Â  archives = archives.filter(a => a.date !== d);
Â  Â  Â  Â  Â  Â  archives.push(arc);
Â  Â  Â  Â  Â  Â  localStorage.setItem("barber_arc", JSON.stringify(archives));
Â  Â  Â  Â  Â  Â  db = db.filter(r => r.date !== d);
Â  Â  Â  Â  Â  Â  localStorage.setItem("barber_db", JSON.stringify(db));
Â  Â  Â  Â  Â  Â  alert("à¸›à¸´à¸”à¸¢à¸­à¸”à¸ªà¸³à¹€à¸£à¹‡à¸ˆ!");
Â  Â  Â  Â  Â  Â  go(3);
Â  Â  Â  Â  }
Â  Â  }

Â  Â  function loadHistDaily() {
Â  Â  Â  Â  const d = document.getElementById("histDate").value;
Â  Â  Â  Â  const found = archives.find(a => a.date === d);
Â  Â  Â  Â  const area = document.getElementById("histDailyArea");
Â  Â  Â  Â  if(!found) { area.innerHTML = "<center style='color:#ccc; padding:20px;'>à¹„à¸¡à¹ˆà¸à¸šà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>"; return; }
Â  Â  Â  Â  let rows = found.details.map(r => `
Â  Â  Â  Â  Â  Â  <div class="history-row" style="font-size:13px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div style="display:flex; justify-content:space-between">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>${r.time} | ${r.svcs.join('+')}</b>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <b>à¸¿${r.price}</b>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div style="font-size:11px; opacity:0.6">${r.hair || ''} (${r.pay==='Cash'?'à¹€à¸‡à¸´à¸™à¸ªà¸”':'à¹‚à¸­à¸™'})</div>
Â  Â  Â  Â  Â  Â  </div>`).join('');
Â  Â  Â  Â  area.innerHTML = `<div style="background:var(--input-bg); padding:15px; border-radius:15px;">
Â  Â  Â  Â  Â  Â  <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px; margin-bottom:15px; font-size:14px;">
Â  Â  Â  Â  Â  Â  Â  Â  <div>à¸¢à¸­à¸”à¸£à¸§à¸¡: <b>${found.total}</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>à¸¥à¸¹à¸à¸„à¹‰à¸²: <b>${found.count}</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>à¸Šà¹ˆà¸²à¸‡à¹„à¸”à¹‰: <b>${found.barber}</b></div>
Â  Â  Â  Â  Â  Â  Â  Â  <div>à¸£à¹‰à¸²à¸™à¹„à¸”à¹‰: <b>${found.shop}</b></div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  ${rows}
Â  Â  Â  Â  </div>`;
Â  Â  }

Â  Â  function loadHistMonth() {
Â  Â  Â  Â  const m = document.getElementById("histMonth").value;
Â  Â  Â  Â  const area = document.getElementById("histMonthArea");
Â  Â  Â  Â  if(!m) return;
Â  Â  Â  Â  const filtered = archives.filter(a => a.date.startsWith(m));
Â  Â  Â  Â  if(!filtered.length) { area.innerHTML = "<center style='color:#ccc'>à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥</center>"; return; }
Â  Â  Â  Â  let tot = 0, bTot = 0;
Â  Â  Â  Â  filtered.forEach(a => { tot += a.total; bTot += a.barber; });
Â  Â  Â  Â  area.innerHTML = `<div style="padding:5px">
Â  Â  Â  Â  Â  Â  <div style="font-size:18px;">à¸£à¸²à¸¢à¹„à¸”à¹‰à¸£à¸§à¸¡: <b style="color:var(--primary)">à¸¿${tot.toLocaleString()}</b></div>
Â  Â  Â  Â  Â  Â  <div style="font-size:13px; opacity:0.8; margin-top:5px;">à¸Šà¹ˆà¸²à¸‡: à¸¿${bTot.toLocaleString()} | à¸£à¹‰à¸²à¸™: à¸¿${(tot-bTot).toLocaleString()}</div>
Â  Â  Â  Â  </div>`;
Â  Â  }

Â  Â  function shareLine() {
Â  Â  const d = document.getElementById("dateInp").value;
Â  Â  const today = db.filter(r => r.date === d);
Â  Â  if (!today.length) return alert("à¹„à¸¡à¹ˆà¸¡à¸µà¸‚à¹‰à¸­à¸¡à¸¹à¸¥");

Â  Â  let tot = 0, cash = 0, trans = 0;
Â  Â  let shave = 0, wash = 0, dye = 0, kid = 0; // à¹€à¸à¸´à¹ˆà¸¡à¸•à¸±à¸§à¹à¸›à¸£à¸™à¸±à¸šà¹€à¸”à¹‡à¸

Â  Â  // à¹€à¸£à¸µà¸¢à¸‡à¹€à¸§à¸¥à¸² à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™ - à¸ªà¸´à¹‰à¸™à¸ªà¸¸à¸” (à¸ªà¸¡à¸¡à¸•à¸´à¸§à¹ˆà¸² r.time à¸„à¸·à¸­ "08:00-08:30")
Â  Â  today.sort((a, b) => a.time.localeCompare(b.time));

Â  Â  today.forEach(r => {
Â  Â  Â  Â  tot += r.price;
Â  Â  Â  Â  if (r.pay === 'Cash') cash += r.price; else trans += r.price;
Â  Â  Â  Â Â 
Â  Â  Â  Â  // à¸™à¸±à¸šà¸ªà¸–à¸´à¸•à¸´ à¹€à¸”à¹‡à¸ à¹à¸¥à¸° à¸­à¸·à¹ˆà¸™à¹†
Â  Â  Â  Â  if (r.mainSvc === "à¹€à¸”à¹‡à¸") kid++;
Â  Â  Â  Â  r.svcs.forEach(s => {
Â  Â  Â  Â  Â  Â  if (s === "à¹‚à¸à¸™à¸«à¸™à¸§à¸”") shave++;
Â  Â  Â  Â  Â  Â  if (s === "à¸ªà¸£à¸°à¸œà¸¡") wash++;
Â  Â  Â  Â  Â  Â  if (s === "à¸¢à¹‰à¸­à¸¡à¸œà¸¡") dye++;
Â  Â  Â  Â  });
Â  Â  });

Â  Â  const bEarn = Math.max(tot * (conf.perc / 100), conf.guar);
Â  Â  const sEarn = tot - bEarn;
Â  Â  const settle = cash - bEarn;

Â  Â  // à¹à¸›à¸¥à¸‡à¸§à¸±à¸™à¸—à¸µà¹ˆ à¸§à¸±à¸™/à¹€à¸”à¸·à¸­à¸™/à¸à¸¨
Â  Â  const ds = d.split('-');
Â  Â  const thaiDate = `${ds[2]}/${ds[1]}/${parseInt(ds[0]) + 543}`;

Â  Â  let msg = `ğŸ’ˆ à¸£à¸²à¸¢à¸‡à¸²à¸™à¸£à¹‰à¸²à¸™: ${conf.shop}\nğŸ“… à¸§à¸±à¸™à¸—à¸µà¹ˆ: ${thaiDate}\n--------------------------\n`;
Â  Â  msg += `ğŸ“ à¸ˆà¸³à¸™à¸§à¸™à¸¥à¸¹à¸à¸„à¹‰à¸² (à¸£à¸§à¸¡ ${today.length} à¸„à¸™):\n`;

Â  Â  today.forEach((r, i) => {
Â  Â  Â  Â  // à¸›à¸£à¸±à¸šà¸à¸²à¸£à¹à¸ªà¸”à¸‡à¸œà¸¥: à¹à¸Ÿà¸Šà¸±à¹ˆà¸™+à¸ªà¸£à¸°(à¹€à¸”à¹‡à¸) = 250 ğŸ’µ
Â  Â  Â  Â  const kidLabel = r.mainSvc === "à¹€à¸”à¹‡à¸" ? "(à¹€à¸”à¹‡à¸)" : "";Â 
Â  Â  Â  Â  const services = r.svcs.length > 0 ? r.svcs.join('+') : "";
Â  Â  Â  Â  const style = r.hair ? r.hair : "";
Â  Â  Â  Â Â 
Â  Â  Â  Â  // à¸•à¹ˆà¸­à¸‚à¹‰à¸­à¸„à¸§à¸²à¸¡: à¸–à¹‰à¸²à¸¡à¸µà¸—à¸£à¸‡à¸œà¸¡ à¸«à¸£à¸·à¸­ à¸šà¸£à¸´à¸à¸²à¸£à¸­à¸·à¹ˆà¸™ à¹ƒà¸«à¹‰à¸„à¸±à¹ˆà¸™à¸”à¹‰à¸§à¸¢à¹€à¸„à¸£à¸·à¹ˆà¸­à¸‡à¸«à¸¡à¸²à¸¢ +
Â  Â  Â  Â  let detail = style;
Â  Â  Â  Â  if (style && services) detail += "+" + services;
Â  Â  Â  Â  else if (!style && services) detail = services;

Â  Â  Â  Â  msg += `${i + 1}. [${r.time}] ${detail}${kidLabel} = ${r.price} ${r.pay === 'Cash' ? 'ğŸ’µ' : 'ğŸ“±'}\n`;
Â  Â  });

Â  Â  msg += `--------------------------\nğŸ“Š à¸ªà¸£à¸¸à¸›à¸‡à¸²à¸™:\n`;
Â  Â  // à¹à¸ªà¸”à¸‡à¸ªà¸–à¸´à¸•à¸´à¸•à¸²à¸¡à¸¥à¸³à¸”à¸±à¸š: à¹€à¸”à¹‡à¸, à¹‚à¸à¸™, à¸ªà¸£à¸°, à¸¢à¹‰à¸­à¸¡
Â  Â  if(kid > 0) msg += `ğŸ§’ à¹€à¸”à¹‡à¸: ${kid} à¸„à¸™\n`;
Â  Â  if(shave > 0) msg += `ğŸª’ à¹‚à¸à¸™à¸«à¸™à¸§à¸”: ${shave} à¸„à¸™\n`;
Â  Â  if(wash > 0) msg += `ğŸš¿ à¸ªà¸£à¸°à¸œà¸¡: ${wash} à¸„à¸£à¸±à¹‰à¸‡\n`;
Â  Â  if(dye > 0) msg += `ğŸ¨ à¸¢à¹‰à¸­à¸¡à¸œà¸¡: ${dye} à¸„à¸£à¸±à¹‰à¸‡\n`;

Â  Â  msg += `--------------------------\n`;
Â  Â  msg += `ğŸ’° à¸¢à¸­à¸”à¸£à¸§à¸¡: ${tot.toLocaleString()} à¸šà¸²à¸—\n`;
Â  Â  msg += `ğŸ“± à¸¢à¸­à¸”à¹‚à¸­à¸™: ${trans.toLocaleString()} à¸šà¸²à¸—\n`;
Â  Â  msg += `ğŸ¤µ à¸Šà¹ˆà¸²à¸‡: ${Math.floor(bEarn).toLocaleString()} à¸šà¸²à¸—\n`;
Â  Â  msg += `ğŸ  à¸£à¹‰à¸²à¸™: ${Math.floor(sEarn).toLocaleString()} à¸šà¸²à¸—\n`;
Â  Â  msg += `--------------------------\n`;

Â  Â  let setMsg = tot === 0 ? "à¸¢à¸­à¸”à¸à¸­à¸”à¸µà¹„à¸¡à¹ˆà¸•à¹‰à¸­à¸‡à¸„à¸·à¸™" : settle > 0 ? `à¸Šà¹ˆà¸²à¸‡à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¹ƒà¸«à¹‰à¸£à¹‰à¸²à¸™ ${Math.floor(settle).toLocaleString()} à¸šà¸²à¸—` : settle < 0 ? `à¸£à¹‰à¸²à¸™à¸„à¸·à¸™à¹€à¸‡à¸´à¸™à¹ƒà¸«à¹‰à¸Šà¹ˆà¸²à¸‡ ${Math.floor(Math.abs(settle)).toLocaleString()} à¸šà¸²à¸—` : "à¸¢à¸­à¸”à¸¥à¸‡à¸•à¸±à¸§à¸à¸­à¸”à¸µ";
Â  Â  msg += `âš ï¸ ${setMsg}`;

Â  Â  window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
}
Â  Â  function openSettings() {Â 
Â  Â  Â  Â  document.getElementById("modalSet").style.display = "flex";Â 
Â  Â  Â  Â  document.getElementById("setShop").value = conf.shop;Â 
Â  Â  Â  Â  document.getElementById("setPerc").value = conf.perc;Â 
Â  Â  Â  Â  document.getElementById("setGuar").value = conf.guar;Â 
Â  Â  Â  Â  document.getElementById("setTheme").value = conf.theme;Â 
Â  Â  }
Â  Â  function closeSettings() { document.getElementById("modalSet").style.display = "none"; }
Â  Â  function setBg(c) { conf.bg = c; applySettings(); }
Â  Â  function changeTheme(v) { conf.theme = v; applySettings(); }
Â  Â  function saveSettings() {Â 
Â  Â  Â  Â  conf.shop = document.getElementById("setShop").value;Â 
Â  Â  Â  Â  conf.perc = Number(document.getElementById("setPerc").value);Â 
Â  Â  Â  Â  conf.guar = Number(document.getElementById("setGuar").value);Â 
Â  Â  Â  Â  conf.theme = document.getElementById("setTheme").value;Â 
Â  Â  Â  Â  localStorage.setItem("barber_conf", JSON.stringify(conf));Â 
Â  Â  Â  Â  applySettings(); closeSettings();Â 
Â  Â  }
Â  Â  function applySettings() {Â 
Â  Â  Â  Â  document.getElementById("shopNameDisp").innerText = conf.shop;Â 
Â  Â  Â  Â  document.getElementById("mainBody").className = "theme-" + conf.theme;Â 
Â  Â  Â  Â  document.getElementById("mainBody").style.backgroundColor = conf.bg;Â 
Â  Â  }
Â  Â  function clearAllData() { if(confirm("à¸¥à¹‰à¸²à¸‡à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”?")) { localStorage.clear(); location.reload(); } }
</script>
</body>
</html>
