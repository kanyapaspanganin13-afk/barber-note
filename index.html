<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Barber Note v4.7 - Full Detail</title>

    <meta property="og:title" content="Barber Note - ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ">
    <meta property="og:image" content="https://i.ibb.co/27GqTXFn/logo.jpg">
    <meta property="og:type" content="website">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Kanit:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #1e3a8a; --accent: #16a34a; --danger: #dc2626; --warning: #f59e0b; --line: #06C755; --card: #ffffff; --text: #1e293b; --input-bg: #f8fafc; }
        body { margin: 0; font-family: 'Kanit', sans-serif; background: #f1f5f9; color: var(--text); padding-bottom: 90px; transition: 0.3s; }
        header { padding: 15px; background: var(--card); display: flex; align-items: center; border-bottom: 1px solid rgba(0,0,0,0.05); position: sticky; top:0; z-index:100; }
        header h1 { flex: 1; text-align: center; font-size: 18px; margin: 0; font-weight: 500; }
        .page { display: none; padding: 15px; }
        .page.active { display: block; }
        .card { background: var(--card); border-radius: 20px; padding: 16px; margin-bottom: 12px; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        label { font-size: 13px; font-weight: 600; opacity: 0.7; margin-bottom: 5px; display: block; color: var(--primary); }
        input, select { width: 100%; padding: 12px; border-radius: 12px; border: none; font-size: 16px; background: var(--input-bg); color: var(--text); outline: none; font-family: 'Kanit'; box-sizing: border-box; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î */
        .history-item { border-bottom: 1px solid #f1f5f9; padding: 10px 0; display: flex; justify-content: space-between; align-items: center; }
        .history-item:last-child { border: none; }
        .svc-info { font-size: 14px; line-height: 1.4; }
        .svc-time { font-size: 11px; color: #64748b; font-weight: bold; }
        
        .settle-bar { padding: 15px; border-radius: 15px; text-align: center; font-weight: 600; margin: 10px 0; font-size: 14px; }
        .bar-red { background: #fee2e2; color: #dc2626; } 
        .bar-green { background: #dcfce7; color: #16a34a; }
        .bar-gray { background: #e2e8f0; color: #475569; } 

        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--card); display: flex; border-top: 1px solid #eee; height: 70px; align-items: center; z-index: 1000; }
        .nav-item { flex: 1; text-align: center; color: #94a3b8; font-size: 12px; }
        .nav-item.active { color: var(--primary); }
        .nav-item i { font-size: 22px; display: block; margin-bottom: 3px; }

        .btn-action { width: 100%; padding: 18px; border-radius: 18px; font-size: 18px; font-weight: 600; border: none; color: white; cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px; }
        .btn-pay { border: 2px solid transparent; background: var(--input-bg); color: var(--text); padding: 15px; border-radius: 12px; font-weight: 600; cursor: pointer; }
        .btn-pay.cash { border-color: var(--warning); color: var(--warning); background: #fffbeb; }
        .btn-pay.trans { border-color: var(--primary); color: var(--primary); background: #eff6ff; }
        
        .line-btn { background: var(--line); color: white; border: none; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 20px; }

        .modal { position: fixed; inset: 0; background: rgba(0,0,0,0.5); display: none; align-items: center; justify-content: center; z-index: 2000; padding: 20px; }
        .modal-content { background: var(--card); border-radius: 25px; padding: 25px; width: 100%; max-width: 400px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); }
        .theme-dot { height: 40px; border-radius: 12px; border: 2px solid #fff; cursor: pointer; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    </style>
</head>
<body id="mainBody">

<header>
    <div style="width:40px"></div>
    <h1 id="shopNameDisp">Barber Note</h1>
    <div style="width:40px; text-align:right;"><i class="fas fa-cog" style="cursor:pointer; font-size:20px;" onclick="openSettings()"></i></div>
</header>

<div id="p1" class="page active">
    <div class="card">
        <label>‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤</label>
        <div class="grid-2">
            <input type="tel" id="tStart" placeholder="‡πÄ‡∏£‡∏¥‡πà‡∏°" maxlength="4" oninput="autoTime(this)">
            <input type="tel" id="tEnd" placeholder="‡πÄ‡∏™‡∏£‡πá‡∏à" maxlength="4" oninput="autoTime(this)">
        </div>
    </div>
    <div class="card">
        <label>‡∏ö‡∏£‡∏¥‡∏Å‡∏≤‡∏£</label>
        <div class="grid-2" style="margin-bottom:10px">
            <select id="svcType"><option value="‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà">‡∏ú‡∏π‡πâ‡πÉ‡∏´‡∏ç‡πà</option><option value="‡πÄ‡∏î‡πá‡∏Å">‡πÄ‡∏î‡πá‡∏Å</option></select>
            <select id="hairStyle"><option value="">(‡∏ó‡∏£‡∏á‡∏ú‡∏°)</option><option>‡∏£‡∏≠‡∏á‡∏ó‡∏£‡∏á</option><option>‡∏™‡∏Å‡∏¥‡∏ô‡πÄ‡∏ü‡∏î</option><option>‡∏ß‡∏¥‡∏ô‡πÄ‡∏ó‡∏à</option><option>‡πÅ‡∏ü‡∏ä‡∏±‡πà‡∏ô</option><option>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option></select>
        </div>
        <div class="grid-2">
            <select id="extra1"><option value="">(‡πÄ‡∏™‡∏£‡∏¥‡∏° 1)</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option></select>
            <select id="extra2"><option value="">(‡πÄ‡∏™‡∏£‡∏¥‡∏° 2)</option><option>‡πÇ‡∏Å‡∏ô‡∏´‡∏ô‡∏ß‡∏î</option><option>‡∏Å‡∏±‡∏ô‡∏´‡∏ô‡πâ‡∏≤</option><option>‡∏™‡∏£‡∏∞‡∏ú‡∏°</option><option>‡∏¢‡πâ‡∏≠‡∏°‡∏ú‡∏°</option><option>‡∏î‡∏±‡∏î‡∏ú‡∏°</option><option>‡πÅ‡∏Å‡πâ‡∏ú‡∏°</option></select>
        </div>
    </div>
    <div class="card">
        <label>‡∏£‡∏≤‡∏Ñ‡∏≤ & ‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞</label>
        <input type="number" id="priceInp" placeholder="0" inputmode="numeric" style="font-size:35px; text-align:center; font-weight:bold; height:70px; color:var(--primary);">
        <div class="grid-2" style="margin-top:10px">
            <button id="btnCash" class="btn-pay" onclick="setPay('Cash')">‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î (üíµ)</button>
            <button id="btnTrans" class="btn-pay" onclick="setPay('Trans')">‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô (üì±)</button>
        </div>
    </div>
    <button class="btn-action" style="background:var(--primary); margin-bottom: 20px;" onclick="handleSave()"><i class="fas fa-save"></i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>

    <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</label>
    <div id="listP1" class="card" style="padding:10px;"></div>
</div>

<div id="p2" class="page">
    <div class="card" style="padding:0; overflow:hidden; display:flex;">
        <div style="flex:1.2; padding:15px; border-right:1px solid #f1f5f9;"><label>‡∏£‡∏≤‡∏¢‡πÑ‡∏î‡πâ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</label><div id="dTotal" style="font-size:24px; font-weight:600;">0</div><div id="dCount" style="font-size:12px; opacity:0.6;">0 ‡∏Ñ‡∏ô</div></div>
        <div style="flex:1; padding:15px; background:#fafafa;">
            <div style="font-size:12px;">‡πÇ‡∏≠‡∏ô: <b id="dTrans">0</b></div>
            <div style="font-size:12px;">‡∏ä‡πà‡∏≤‡∏á: <b id="dBarber">0</b></div>
            <div style="font-size:12px;">‡∏£‡πâ‡∏≤‡∏ô: <b id="dShop">0</b></div>
        </div>
    </div>
    <div id="settleBar" class="settle-bar"></div>
    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
            <label>‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
            <button class="line-btn" onclick="sendLine('today')"><i class="fab fa-line"></i></button>
        </div>
        <div id="listP2"></div>
    </div>
    <button class="btn-action" style="background:var(--accent);" onclick="closeDay()"><i class="fas fa-paper-plane"></i> ‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î & ‡πÄ‡∏Å‡πá‡∏ö‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</button>
</div>

<div id="p3" class="page">
    <div class="card">
        <label>‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
        <input type="date" id="histDate" onchange="loadArchive()">
    </div>
    <div id="arcArea" style="display:none;">
        <div class="card" style="padding:0; overflow:hidden; display:flex; border:1px solid var(--primary);">
            <div style="flex:1.2; padding:15px; border-right:1px solid #eee;"><label>‡∏¢‡∏≠‡∏î‡∏ß‡∏±‡∏ô‡∏ô‡∏±‡πâ‡∏ô</label><div id="arcTotal" style="font-size:24px; font-weight:600;">0</div></div>
            <div style="flex:1; padding:15px; background:#f8fafc;">
                <div style="font-size:12px;">‡∏ä‡πà‡∏≤‡∏á: <b id="arcBarber">0</b></div>
                <div style="font-size:12px;">‡∏£‡πâ‡∏≤‡∏ô: <b id="arcShop">0</b></div>
            </div>
        </div>
        <div id="arcSettle" class="settle-bar"></div>
        <div class="card">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px;">
                <label>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏¢‡πâ‡∏≠‡∏ô‡∏´‡∏•‡∏±‡∏á‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</label>
                <button class="line-btn" id="btnLineArc"><i class="fab fa-line"></i></button>
            </div>
            <div id="listP3"></div>
        </div>
    </div>
</div>

<div id="modalSet" class="modal">
    <div class="modal-content">
        <h3 style="margin:0 0 15px 0;">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏£‡∏∞‡∏ö‡∏ö</h3>
        <label>‡∏ä‡∏∑‡πà‡∏≠‡∏£‡πâ‡∏≤‡∏ô</label><input type="text" id="setShop">
        <div class="grid-2" style="margin:10px 0">
            <div><label>% ‡∏ä‡πà‡∏≤‡∏á</label><input type="number" id="setPerc"></div>
            <div><label>‡∏õ‡∏£‡∏∞‡∏Å‡∏±‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</label><input type="number" id="setGuar"></div>
        </div>
        <label>‡∏ò‡∏µ‡∏°‡∏™‡∏µ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á</label>
        <div class="grid-2" style="grid-template-columns: repeat(4, 1fr); gap:10px;">
            <div class="theme-dot" style="background:#fffbeb;" onclick="setTheme('#fffbeb')"></div>
            <div class="theme-dot" style="background:#fff1f2;" onclick="setTheme('#fff1f2')"></div>
            <div class="theme-dot" style="background:#f0fdf4;" onclick="setTheme('#f0fdf4')"></div>
            <div class="theme-dot" style="background:#f1f5f9;" onclick="setTheme('#f1f5f9')"></div>
        </div>
        <button class="btn-action" style="background:var(--primary); margin-top:20px;" onclick="saveSettings()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
        <button class="btn-action" style="background:#ccc; margin-top:10px;" onclick="closeSettings()">‡∏õ‡∏¥‡∏î</button>
    </div>
</div>

<nav class="nav">
    <div class="nav-item active" id="n1" onclick="go(1)"><i class="fas fa-edit"></i>‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</div>
    <div class="nav-item" id="n2" onclick="go(2)"><i class="fas fa-list-ul"></i>‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</div>
    <div class="nav-item" id="n3" onclick="go(3)"><i class="fas fa-history"></i>‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥</div>
</nav>

<script>
    let payMethod = "";
    let conf = JSON.parse(localStorage.getItem("bn47_conf")) || {shop:"Barber Note", perc:50, guar:0, bg:"#f1f5f9"};
    let db = JSON.parse(localStorage.getItem("bn47_db")) || [];
    let archives = JSON.parse(localStorage.getItem("bn47_arc")) || [];

    function setTheme(c) { conf.bg = c; document.body.style.background = c; }
    function applyConf() { document.getElementById("shopNameDisp").innerText = conf.shop; document.body.style.background = conf.bg; renderAll(); }
    function autoTime(el) { let v = el.value.replace(/\D/g,''); if(v.length===4) el.value = v.substring(0,2)+":"+v.substring(2,4); }
    function setPay(m) { payMethod = m; document.getElementById("btnCash").style.border = m==='Cash'?'2px solid var(--warning)':'none'; document.getElementById("btnTrans").style.border = m==='Trans'?'2px solid var(--primary)':'none'; }
    
    function go(n) { 
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
        document.getElementById('p'+n).classList.add('active');
        document.getElementById('n'+n).classList.add('active');
        renderAll();
    }

    function handleSave() {
        const p = document.getElementById("priceInp").value;
        if(!p || !payMethod) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏∞‡∏ö‡∏∏‡∏£‡∏≤‡∏Ñ‡∏≤‡πÅ‡∏•‡∏∞‡∏ß‡∏¥‡∏ò‡∏µ‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô");
        db.push({
            id: Date.now(),
            date: new Date().toLocaleDateString('th-TH'),
            time: `${document.getElementById("tStart").value || '00:00'}-${document.getElementById("tEnd").value || '00:00'}`,
            style: document.getElementById("hairStyle").value || "‡∏ï‡∏±‡∏î‡∏ú‡∏°",
            type: document.getElementById("svcType").value,
            extra: [document.getElementById("extra1").value, document.getElementById("extra2").value].filter(x => x !== ""),
            price: Number(p),
            pay: payMethod
        });
        localStorage.setItem("bn47_db", JSON.stringify(db));
        document.getElementById("priceInp").value = "";
        document.getElementById("tStart").value = document.getElementById("tEnd").value;
        document.getElementById("tEnd").value = "";
        setPay(""); renderAll();
    }

    function renderAll() {
        const d = new Date().toLocaleDateString('th-TH');
        const today = db.filter(r => r.date === d);
        
        // Render ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 1 ‡πÅ‡∏•‡∏∞‡∏´‡∏ô‡πâ‡∏≤ 2
        let html = "";
        let total = 0, trans = 0, cash = 0;
        today.slice().reverse().forEach(r => {
            total += r.price; if(r.pay==='Trans') trans += r.price; else cash += r.price;
            let svcLine = `${r.style}${r.extra.length>0 ? '+'+r.extra.join('+') : ''} (${r.type})`;
            html += `<div class="history-item"><div class="svc-info"><span class="svc-time">[${r.time}]</span><br>${svcLine}</div><div><b>${r.price}</b> ${r.pay==='Cash'?'üíµ':'üì±'} <i class="fas fa-trash" style="color:#eee; margin-left:8px;" onclick="del(${r.id})"></i></div></div>`;
        });
        
        document.getElementById("listP1").innerHTML = html || "<center style='opacity:0.3'>‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£</center>";
        document.getElementById("listP2").innerHTML = html || "<center style='padding:20px; opacity:0.3;'>‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏á‡∏≤‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</center>";

        // ‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏´‡∏ô‡πâ‡∏≤ 2
        const bNet = Math.max(total * (conf.perc/100), conf.guar);
        const settle = cash - bNet;
        document.getElementById("dTotal").innerText = total.toLocaleString();
        document.getElementById("dCount").innerText = today.length + " ‡∏Ñ‡∏ô";
        document.getElementById("dTrans").innerText = trans.toLocaleString();
        document.getElementById("dBarber").innerText = Math.floor(bNet).toLocaleString();
        document.getElementById("dShop").innerText = Math.floor(total - bNet).toLocaleString();
        
        const bar = document.getElementById("settleBar");
        if(total === 0) { bar.innerText = "‡∏£‡∏≠‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£"; bar.className="settle-bar bar-gray"; }
        else if(Math.abs(settle) < 1) { bar.innerText = "‚úÖ ‡∏¢‡∏≠‡∏î‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î‡∏û‡∏≠‡∏î‡∏µ"; bar.className="settle-bar bar-gray"; }
        else if(settle > 0) { bar.innerText = `üü• ‡∏ä‡πà‡∏≤‡∏á‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏£‡πâ‡∏≤‡∏ô ‡∏ø${Math.floor(settle)}`; bar.className="settle-bar bar-red"; }
        else { bar.innerText = `üü© ‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡∏∑‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏ä‡πà‡∏≤‡∏á ‡∏ø${Math.floor(Math.abs(settle))}`; bar.className="settle-bar bar-green"; }
    }

    function sendLine(type, dateStr, data) {
        let targetData = data;
        let targetDate = dateStr;
        if(type === 'today') {
            targetDate = new Date().toLocaleDateString('th-TH');
            targetData = db.filter(r => r.date === targetDate);
        }
        if(!targetData || !targetData.length) return alert("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•");

        let total = 0, cash = 0;
        let msg = `‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô: ${conf.shop}\nüìÖ ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${targetDate}\n------------------\n`;
        targetData.forEach((r, i) => {
            total += r.price; if(r.pay==='Cash') cash += r.price;
            msg += `${i+1}. [${r.time}] ${r.style}${r.extra.length>0?'+'+r.extra.join('+'):''}(${r.type}) = ${r.price} ${r.pay==='Cash'?'üíµ':'üì±'}\n`;
        });
        const bNet = Math.max(total * (conf.perc/100), conf.guar);
        msg += `------------------\nüí∞ ‡∏¢‡∏≠‡∏î‡∏£‡∏ß‡∏°: ${total}\nü§µ ‡∏ä‡πà‡∏≤‡∏á: ${Math.floor(bNet)}\nüè† ‡∏£‡πâ‡∏≤‡∏ô: ${Math.floor(total-bNet)}`;
        window.open(`https://line.me/R/msg/text/?${encodeURIComponent(msg)}`);
    }

    function loadArchive() {
        const input = document.getElementById("histDate").value; if(!input) return;
        const d = new Date(input).toLocaleDateString('th-TH');
        const found = archives.find(a => a.date === d);
        const area = document.getElementById("arcArea");
        if(!found) { area.style.display="none"; return alert("‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•"); }
        area.style.display="block";
        document.getElementById("arcTotal").innerText = found.total.toLocaleString();
        document.getElementById("arcBarber").innerText = Math.floor(found.barber).toLocaleString();
        document.getElementById("arcShop").innerText = Math.floor(found.shop).toLocaleString();
        
        let html = "";
        found.details.forEach(r => {
            let svcLine = `${r.style}${r.extra.length>0 ? '+'+r.extra.join('+') : ''} (${r.type})`;
            html += `<div class="history-item"><div class="svc-info"><span class="svc-time">[${r.time}]</span><br>${svcLine}</div><div><b>${r.price}</b> ${r.pay==='Cash'?'üíµ':'üì±'}</div></div>`;
        });
        document.getElementById("listP3").innerHTML = html;
        document.getElementById("btnLineArc").onclick = () => sendLine('archive', d, found.details);
    }

    function closeDay() {
        if(confirm("‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡πÅ‡∏•‡∏∞‡∏™‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥?")) {
            const d = new Date().toLocaleDateString('th-TH');
            const today = db.filter(r => r.date === d);
            if(!today.length) return;
            const tot = today.reduce((a,b)=>a+b.price, 0);
            const bNet = Math.max(tot * (conf.perc/100), conf.guar);
            archives = archives.filter(a => a.date !== d);
            archives.push({ date: d, total: tot, barber: bNet, shop: tot-bNet, details: today, cash: today.filter(r=>r.pay==='Cash').reduce((a,b)=>a+b.price, 0) });
            localStorage.setItem("bn47_arc", JSON.stringify(archives));
            db = db.filter(r => r.date !== d);
            localStorage.setItem("bn47_db", JSON.stringify(db));
            alert("‡∏õ‡∏¥‡∏î‡∏¢‡∏≠‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢"); go(3);
        }
    }

    function openSettings() { document.getElementById("modalSet").style.display="flex"; document.getElementById("setShop").value=conf.shop; document.getElementById("setPerc").value=conf.perc; document.getElementById("setGuar").value=conf.guar; }
    function closeSettings() { document.getElementById("modalSet").style.display="none"; }
    function saveSettings() { conf.shop = document.getElementById("setShop").value; conf.perc = Number(document.getElementById("setPerc").value); conf.guar = Number(document.getElementById("setGuar").value); localStorage.setItem("bn47_conf", JSON.stringify(conf)); applyConf(); closeSettings(); }
    function del(id) { if(confirm("‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£?")) { db = db.filter(r => r.id !== id); localStorage.setItem("bn47_db", JSON.stringify(db)); renderAll(); } }
    
    applyConf();
</script>
</body>
</html>
